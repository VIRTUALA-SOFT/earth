<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guardianes del Valle | Experiencia Inmersiva</title>
    <!-- Evitar error de favicon en consola -->
    <link rel="icon" href="data:,">
    
    <!-- FUENTES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Manrope:wght@200;400;600&display=swap" rel="stylesheet">
    
    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --c-bg: #050505;
            --c-gold: #D4AF37;
            --c-neon: #00f2ff;
        }

        html {
            background-color: var(--c-bg); /* El color de fondo va al HTML, no al body */
        }

        body {
            background-color: transparent; /* IMPORTANTE: Transparente para ver el 3D detrás */
            color: #e5e5e5;
            font-family: 'Manrope', sans-serif;
            overflow-x: hidden;
            margin: 0;
            -webkit-font-smoothing: antialiased;
        }

        h1, h2, h3, .serif {
            font-family: 'Cinzel', serif;
        }

        #webgl-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Detrás de todo */
            opacity: 0; 
            transition: opacity 2s ease;
        }

        /* Ocultar barra de scroll nativa para estética */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* LOADER */
        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #050505;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loader-bar-container {
            width: 200px;
            height: 2px;
            background: #333;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .loader-line {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--c-gold), var(--c-neon));
            transition: width 0.2s linear;
        }
    </style>
</head>
<body>

    <!-- CANVAS 3D (Fondo) -->
    <canvas id="webgl-canvas"></canvas>

    <!-- PRELOADER -->
    <div class="loader" id="loader">
        <div class="serif text-2xl tracking-[0.5em] text-[#D4AF37]">ANCESTRALIDAD</div>
        <div class="loader-bar-container">
            <div class="loader-line" id="loader-bar"></div>
        </div>
        <div class="mt-2 text-xs text-gray-500 font-mono" id="loader-text">0%</div>
    </div>

    <!-- UI SUPERIOR -->
    <nav class="fixed top-0 left-0 w-full p-8 flex justify-between items-center z-50 mix-blend-difference pointer-events-none">
        <div class="text-sm tracking-widest uppercase font-bold pointer-events-auto cursor-pointer">Kogi / <span class="text-[#D4AF37]">The Lost City</span></div>
        <div class="pointer-events-auto cursor-pointer group">
            <div class="w-10 h-10 border border-white/20 rounded-full flex items-center justify-center group-hover:border-[#D4AF37] transition-colors duration-300">
                <div class="w-1 h-1 bg-white rounded-full group-hover:bg-[#D4AF37]"></div>
            </div>
        </div>
    </nav>

    <!-- CONTENIDO -->
    <main class="relative z-10 opacity-0" id="main-content">

        <!-- HERO -->
        <section class="h-screen w-full flex flex-col justify-center items-center relative">
            <div class="text-center p-4">
                <p class="hero-anim text-[#D4AF37] text-sm tracking-[0.4em] mb-6 uppercase">Patrimonio Vivo</p>
                <h1 class="hero-anim text-5xl md:text-8xl font-bold leading-none tracking-tighter mix-blend-overlay text-white opacity-90">
                    ESPÍRITUS<br>
                    <span class="italic font-light text-white/70">DEL VALLE</span>
                </h1>
                <div class="hero-anim mt-12 max-w-md mx-auto text-center text-gray-400 font-light leading-relaxed glass-panel p-6 rounded-lg">
                    <p>Una inmersión digital en la cosmogonía de los pueblos originarios. Desliza para entrar.</p>
                </div>
            </div>
        </section>

        <!-- CONTENIDO DETALLADO -->
        <section class="min-h-screen w-full py-32 px-6 md:px-20 flex items-center">
            <div class="max-w-4xl">
                <span class="block text-[#00f2ff] text-xs font-mono mb-4 section-tag">01 — EL ORIGEN</span>
                <h2 class="text-4xl md:text-6xl mb-10 leading-tight section-title text-white">
                    "La tierra no nos pertenece, <br>
                    <span class="text-gray-500">nosotros pertenecemos a la tierra."</span>
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <p class="text-gray-400 leading-loose">
                        En el corazón de la sierra, las estructuras no son simples viviendas, son reflejos del cosmos. Cada choza está alineada con las estrellas.
                    </p>
                    <div class="glass-panel p-8 rounded-xl border-l-2 border-[#D4AF37]">
                        <h3 class="text-xl mb-2 text-white">La Maloka</h3>
                        <p class="text-sm text-gray-400">Centro ceremonial y de pensamiento. Aquí, los Mamos tejen el equilibrio del mundo.</p>
                    </div>
                </div>
            </div>
        </section>

        <footer class="h-[50vh] flex items-center justify-center border-t border-white/10 bg-black relative z-20">
            <h2 class="text-4xl md:text-6xl text-[#333] font-bold">FIN</h2>
        </footer>

    </main>

    <!-- SCRIPTS ACTUALIZADOS Y BLINDADOS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <!-- Lenis versión más estable para CDN directo -->
    <script src="https://unpkg.com/lenis@1.0.42/dist/lenis.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Iniciando experiencia...");

            // ELEMENTOS DOM
            const loaderBar = document.getElementById('loader-bar');
            const loaderText = document.getElementById('loader-text');
            const loader = document.getElementById('loader');
            const mainContent = document.getElementById('main-content');
            const canvasEl = document.getElementById('webgl-canvas');

            // --- 1. CARGA SIMULADA ---
            let loadProgress = 0;
            const loadInterval = setInterval(() => {
                loadProgress += Math.random() * 8;
                if (loadProgress >= 100) {
                    loadProgress = 100;
                    clearInterval(loadInterval);
                    revealSite();
                }
                if(loaderBar) loaderBar.style.width = `${loadProgress}%`;
                if(loaderText) loaderText.innerText = `${Math.floor(loadProgress)}%`;
            }, 60);

            function revealSite() {
                const tl = gsap.timeline();
                tl.to(loader, { opacity: 0, duration: 1, pointerEvents: 'none', onComplete: () => loader.style.display = 'none' })
                  .to(canvasEl, { opacity: 1, duration: 2 }, "-=0.5")
                  .to(mainContent, { opacity: 1, duration: 1 }, "-=1.5")
                  .from(".hero-anim", { y: 50, opacity: 0, duration: 1.5, stagger: 0.2, ease: "power3.out" }, "-=0.5");
            }

            // --- 2. THREE.JS (FONDO DE PARTÍCULAS) ---
            try {
                const scene = new THREE.Scene();
                // Ajustamos la niebla para que coincida con el fondo CSS
                scene.fog = new THREE.FogExp2(0x050505, 0.002);

                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({
                    canvas: canvasEl,
                    antialias: true,
                    alpha: true // Crucial para ver el fondo
                });
                
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

                // Crear partículas
                const geometry = new THREE.BufferGeometry();
                const count = 2500;
                const positions = new Float32Array(count * 3);
                const colors = new Float32Array(count * 3);
                
                const c1 = new THREE.Color(0xD4AF37);
                const c2 = new THREE.Color(0x00f2ff);

                for(let i = 0; i < count * 3; i+=3) {
                    positions[i] = (Math.random() - 0.5) * 18;
                    positions[i+1] = (Math.random() - 0.5) * 18;
                    positions[i+2] = (Math.random() - 0.5) * 18;

                    let c = Math.random() > 0.5 ? c1 : c2;
                    colors[i] = c.r; colors[i+1] = c.g; colors[i+2] = c.b;
                }

                geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

                const material = new THREE.PointsMaterial({
                    size: 0.03,
                    vertexColors: true,
                    transparent: true,
                    opacity: 0.8,
                    blending: THREE.AdditiveBlending
                });

                const particles = new THREE.Points(geometry, material);
                scene.add(particles);
                camera.position.z = 4;

                // Mouse
                let mouseX = 0;
                let mouseY = 0;
                let targetX = 0;
                let targetY = 0;
                const windowHalfX = window.innerWidth / 2;
                const windowHalfY = window.innerHeight / 2;

                document.addEventListener('mousemove', (event) => {
                    mouseX = (event.clientX - windowHalfX);
                    mouseY = (event.clientY - windowHalfY);
                });

                // Loop
                const clock = new THREE.Clock();
                const tick = () => {
                    const elapsed = clock.getElapsedTime();
                    targetX = mouseX * 0.0005;
                    targetY = mouseY * 0.0005;

                    particles.rotation.y += 0.05 * (targetX - particles.rotation.y);
                    particles.rotation.x += 0.05 * (targetY - particles.rotation.x);
                    particles.rotation.y += 0.002; // Rotación constante

                    renderer.render(scene, camera);
                    window.requestAnimationFrame(tick);
                }
                tick();

                // Resize
                window.addEventListener('resize', () => {
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                });

                // GSAP Scroll Effect
                gsap.registerPlugin(ScrollTrigger);
                gsap.to(particles.position, {
                    scrollTrigger: { trigger: "body", start: "top top", end: "bottom bottom", scrub: 1 },
                    z: 6, // Viaje hacia adentro
                    y: 2
                });

            } catch (e) {
                console.error("Error en 3D:", e);
            }

            // --- 3. LENIS SCROLL (FIX PARA GITHUB PAGES) ---
            try {
                if (typeof Lenis !== 'undefined') {
                    const lenis = new Lenis({
                        duration: 1.2,
                        smooth: true
                    });
                    function raf(time) {
                        lenis.raf(time);
                        requestAnimationFrame(raf);
                    }
                    requestAnimationFrame(raf);
                    console.log("Lenis activo");
                } else {
                    console.warn("Lenis no cargó correctamente, usando scroll nativo.");
                }
            } catch (e) {
                console.warn("Error iniciando Lenis:", e);
            }
        });
    </script>
</body>
</html>
