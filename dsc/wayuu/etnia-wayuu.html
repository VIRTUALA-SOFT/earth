<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nación Wayuu | Inmersión Digital</title>
    
    <!-- FUENTES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Syncopate:wght@400;700&family=Manrope:wght@200;300;400;500&display=swap" rel="stylesheet">
    
    <!-- LIBRERÍAS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>

    <!-- MAPBOX GL JS -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    
    <style>
         :root {
        --c-bg: #050200;
        --c-sand: #C89F65;
        --c-accent: #FF3B3B;
        --c-star: #A5D8FF;
    }

    body { 
        background-color: var(--c-bg); 
        color: #f3f3f3; 
        font-family: 'Manrope', sans-serif; 
        overflow-x: hidden; 
        cursor: none; 
        margin: 0;
    }

    .font-display { font-family: 'Playfair Display', serif; }
    .font-decor { font-family: 'Cinzel Decorative', serif; }
    .font-tech { font-family: 'Syncopate', sans-serif; }

    /* CURSOR */
 #cursor {
        position: fixed; top: 0; left: 0; width: 20px; height: 20px;
        background: #ffffff; 
        border-radius: 50%;
        pointer-events: none; 
        z-index: 99999; /* Máxima prioridad */
        transform: translate(-50%, -50%); 
        transition: width 0.3s cubic-bezier(0.19, 1, 0.22, 1), 
                    height 0.3s cubic-bezier(0.19, 1, 0.22, 1), 
                    background-color 0.2s;
        mix-blend-mode: difference; /* Inversión por defecto */
        display: flex; justify-content: center; align-items: center;
    }
    
    #cursor span { 
        opacity: 0; 
        font-size: 10px; font-weight: 800; color: white; 
        font-family: 'Syncopate', sans-serif; letter-spacing: 1px;
        pointer-events: none;
    }

    /* ESTADO: AUDIO (EL ROJO IMPORTANTE) */
    #cursor.audio-mode { 
        width: 90px !important; 
        height: 90px !important; 
        background: #FF3B3B !important; /* Rojo Forzado */
        border: none !important;
        mix-blend-mode: normal !important; /* APAGAMOS LA MEZCLA para que se vea rojo puro */            
        opacity: 1 !important;
        box-shadow: 0 4 30px rgba(255, 59, 59, 0.5) !important;            
    }
    
   #cursor.audio-mode span {         
    opacity: 1 !important; 
    color: white !important;
    font-weight: 800;
    font-size: 12px;
  }
/* ESTADO: HOVER SIMPLE */
#cursor.hovered { width: 50px; height: 50px; background: white; mix-blend-mode: difference; }

/* ESTADO: SUEÑOS */
    #cursor.dream-mode { width: 150px; height: 150px; background: rgba(255,255,255,0.1); backdrop-filter: blur(5px); mix-blend-mode: normal; }


  /* ESTADO: VIDEO */
    #cursor.video-mode { 
        width: 100px; 
        height: 100px; 
        background: white; 
        mix-blend-mode: difference; 
    }
    #cursor.video-mode span { 
        opacity: 1; 
        color: black; /* Texto negro sobre fondo blanco */
    }
 

    /* UTILIDADES VISUALES */
    #global-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; opacity: 0; }
    
    .giant-text {
        font-size: clamp(4rem, 15vw, 20rem); line-height: 0.8; color: transparent;
        -webkit-text-stroke: 1px rgba(255,255,255,0.3); mix-blend-mode: overlay;
    }
    .giant-text span { color: var(--c-sand); -webkit-text-stroke: 0; }

    .hero-video-bg {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;
        opacity: 0.5; filter: contrast(1.1) brightness(0.8);
        mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
    }

    /* TILT CARDS */
 /*   .tilt-card {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transform-style: preserve-3d;
        transform: perspective(1000px);
        transition: all 0.3s ease;
    }*/
   /* .tilt-card:hover { border-color: var(--c-sand); background: rgba(255, 255, 255, 0.1); }*/
    .tilt-inner { transform: translateZ(20px); }        
    
    /* LOADER */
    .loader {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: var(--c-bg); z-index: 10000;
        display: flex; justify-content: center; align-items: center; flex-direction: column;
        transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    .loader-line {
        width: 0%; height: 2px; background: linear-gradient(90deg, var(--c-accent), var(--c-sand)); transition: width 0.2s linear;
    }
    
    /* Estado inicial del contenido principal */
    #main-content {
        opacity: 0;
        transition: opacity 1.5s ease;
    }

    .cosmos-bg {
        position: absolute; inset: 0; background: radial-gradient(circle at center, #0B1026 0%, #000000 100%);
        opacity: 0; transition: opacity 1.5s ease; pointer-events: none;
    }
    
     /* PLAY BUTTON */
    .play-btn {
        width: 48px; height: 48px; border-radius: 50%;
        border: 1px solid rgba(255,255,255,0.3);
        display: flex; align-items: center; justify-content: center;
        transition: all 0.3s;
    }
    .tilt-card:hover .play-btn { background: var(--c-sand); border-color: var(--c-sand); color: black; transform: scale(1.1); }

    ::-webkit-scrollbar { width: 0px; }

    /* --- ECUALIZADOR ANIMADO --- */
    @keyframes equalize {
        0% { height: 3px; }
        50% { height: 100%; }
        100% { height: 3px; }
    }
    
    .bar {
        width: 3px;
        background-color: currentColor; /* Hereda el color del texto */
        border-radius: 9999px;
        animation: equalize 1s infinite ease-in-out;
    }
    
    /* Retrasos para que parezca aleatorio */
    .bar:nth-child(1) { animation-delay: -0.4s; height: 60%; }
    .bar:nth-child(2) { animation-delay: -0.2s; height: 100%; }
    .bar:nth-child(3) { animation-delay: -0.6s; height: 40%; }
    .bar:nth-child(4) { animation-delay: -0.8s; height: 80%; }
    
    /* Estado Pausado (opcional, si quieres que se detengan al pausar) */
    .paused .bar { animation-play-state: paused; height: 3px !important; transition: height 0.3s; }

    /* --- FONDO CINEMÁTICO --- */
    .desert-bg {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        object-fit: cover;
        z-index: 0;
        /* Efecto de Zoom lento constante para dar vida */
        animation: slowZoom 60s infinite alternate;
    }
    
    @keyframes slowZoom {
        from { transform: scale(1); }
        to { transform: scale(1.15); }
    }
    
    /* Capa oscura para garantizar lectura */
    .desert-overlay {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: radial-gradient(circle at center, rgba(0,0,0,0.6) 0%, #050200 100%);
        z-index: 1;
        pointer-events: none;
    }
    
            /* --- TARJETAS CRISTAL (MIRAGE EFFECT) --- */
    .tilt-card {
        /* Fondo semi-transparente oscuro */
        background: rgba(0, 0, 0, 0.4); 
        /* Desenfoque fuerte para suavizar el fondo */
        backdrop-filter: blur(20px); 
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.4s ease;
        z-index: 10; /* Encima del fondo */
    }
    
    /* AL HACER HOVER O REPRODUCIR */
    .tilt-card:hover, .tilt-card.playing {
        /* Se vuelve más transparente para ver el desierto detrás */
        background: rgba(255, 255, 255, 0.05); 
        backdrop-filter: blur(5px); /* Menos desenfoque = Más nitidez del fondo */
        border-color: var(--c-sand);
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    }
    
    /* Texto Wayuunaiki más brillante para contrastar */
    .tilt-card h3 { text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

    /* --- DEGRADADO DE BORDES (CINEMATIC FADE) --- */
    .cinematic-fade {
        position: absolute;
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%;
        pointer-events: none; /* Permite dar clic a través de ella */
        z-index: 2; /* Se coloca encima de la imagen y del overlay oscuro */
        background: linear-gradient(
            to bottom,
            #050200 0%,        /* Negro arriba */
            transparent 20%,   /* Se vuelve transparente al bajar */
            transparent 80%,   /* Se mantiene transparente */
            #050200 100%       /* Vuelve a negro abajo */
        );
    }

     /* HORIZONTAL SCROLL (IDENTITY) */
    .horizontal-container {
        width: 400%; /* 4 Paneles */
        height: 100vh;
        display: flex;
        flex-wrap: nowrap;
    }
    .panel {
        width: 100vw;
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        padding: 4rem;
        border-right: 1px solid rgba(255,255,255,0.05);
    }
    .panel-bg {
        position: absolute; inset: 0; z-index: 0;
        filter: brightness(0.4) grayscale(0.5);
        transition: transform 0.5s;
    }
    .panel:hover .panel-bg { transform: scale(1.02); filter: brightness(0.5) grayscale(0.2); }

     /* JEPIRA (COSMOS) */
    .warp-speed-effect {
        position: absolute; inset: 0;
        background: radial-gradient(circle at center, transparent 0%, #000 90%);
        z-index: 1;
    }

    /* --- MEJORA DE VIDEO (MÁS LUZ Y COLOR) --- */
.cinematic-video {
width: 100%;
height: 100%;
object-fit: cover;
opacity: 0.9; /* Subimos de 0.6 a 0.9 (Mucho más visible) /
filter: contrast(1.1) saturate(1.2); / Realza los colores del desierto */
transition: opacity 0.5s ease;
}

/* --- CONTINUIDAD (BORDES FUNDIDOS) --- */
/* Esto crea el degradado negro arriba y abajo para que no se note el corte */
.panel-fade {
position: absolute;
inset: 0;
pointer-events: none; /* Permite dar clic a través */
z-index: 2;
background: linear-gradient(
to bottom,
#050200 0%,         /* Negro arriba (fusión con sección anterior) */
transparent 15%,    /* Transparente rápido para ver el video */
transparent 85%,    /* Se mantiene transparente */
#050200 100%        /* Negro abajo (fusión con footer/siguiente) */
);
}
/* --- SOMBRA SOLO DETRÁS DEL TEXTO --- /
/ En lugar de oscurecer todo el video, oscurecemos solo donde va el texto */
.text-protection {
position: absolute;
inset: 0;
background: radial-gradient(circle at center, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.6) 100%);
z-index: 1;
}
/* JEPIRA: Fondo transparente para ver el Canvas */
#jepira-section {
position: relative;
background-color: transparent !important; /* Forzar transparencia */
z-index: 20;
overflow: hidden; /* Evita scrollbars si las estrellas se salen */
}
/* El degradado azul cósmico (Sutil) */
#cosmos-overlay {
position: absolute;
inset: 0;
background: radial-gradient(circle at center, rgba(11, 20, 54, 0.8) 0%, #000000 90%);
opacity: 0;
transition: opacity 1s ease;
z-index: -1; /* Detrás del texto */
pointer-events: none;
}

        /* --- ESTILOS NUEVOS: BIO-RADAR Y MAPA --- */

/* 1. SECCIÓN DEL RADAR */
.radar-container {
    position: relative; width: 400px; height: 400px;
    max-width: 90vw; max-height: 90vw;
    display: flex; justify-content: center; align-items: center; margin: 0 auto;
}
.radar-ring {
    position: absolute; border-radius: 50%; border: 1px solid #00f3ff;
    opacity: 0.3; box-shadow: 0 0 10px #00f3ff;
}
.ring-1 { width: 100%; height: 100%; animation: spin 40s linear infinite; border-style: dashed; opacity: 0.15; }
.ring-2 { width: 65%; height: 65%; animation: pulse-ring 4s infinite; border: 1px solid rgba(0, 243, 255, 0.3); }

/* Núcleo del Radar (Botón) */
.radar-core { 
    width: 30%; height: 30%; border-radius: 50%;
    background: rgba(0, 243, 255, 0.05); border: 1px solid #00f3ff;
    backdrop-filter: blur(5px); cursor: pointer; z-index: 10;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    transition: 0.4s;
}
.radar-core:hover { background: rgba(0, 243, 255, 0.2); transform: scale(1.1); box-shadow: 0 0 30px #00f3ff; }

/* Iconos Orbitales */
.orbit-track { position: absolute; width: 100%; height: 100%; animation: spin 50s linear infinite; }
.orbit-item { position: absolute; display: flex; flex-direction: column; align-items: center; animation: spin-reverse 50s linear infinite; }

.orbit-icon {
    width: 40px; height: 40px; background: #000; border: 1px solid #00f3ff; border-radius: 50%;
    display: flex; justify-content: center; align-items: center; color: #00f3ff; box-shadow: 0 0 10px #00f3ff; margin-bottom: 5px;
}
.orbit-label { font-family: 'Syncopate', sans-serif; font-size: 8px; color: #00f3ff; letter-spacing: 1px; }

/* Posiciones de los satélites */
.pos-1 { top: 0; left: 50%; transform: translate(-50%, -50%); } 
.pos-2 { bottom: 15%; right: 15%; } 
.pos-3 { bottom: 15%; left: 15%; }
.pos-3 .orbit-icon { border-color: #ff0055; color: #ff0055; box-shadow: 0 0 10px #ff0055; } /* Sagrado */
.pos-3 .orbit-label { color: #ff0055; }

@keyframes spin { 100% { transform: rotate(360deg); } }
@keyframes spin-reverse { 100% { transform: rotate(-360deg); } }
@keyframes pulse-ring { 0% { transform: scale(0.95); opacity: 0.1; } 50% { transform: scale(1); opacity: 0.4; } 100% { transform: scale(0.95); opacity: 0.1; } }

/* 2. VENTANA MODAL DEL MAPA */
#mapbox-modal {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; z-index: 9999; /* Encima de todo */
    transform: translateY(100%); transition: transform 0.8s cubic-bezier(0.86, 0, 0.07, 1);
}
#mapbox-modal.open { transform: translateY(0); }
#map-container { width: 100%; height: 100%; }

/* Controles del Mapa (HUD) */
.map-hud {
    position: absolute; top: 100px; left: 5%; width: 300px; z-index: 10;
    background: rgba(10,15,20,0.9); padding: 20px; border-left: 3px solid #C89F65;
    backdrop-filter: blur(10px);
}
.layer-btn {
    display: flex; align-items: center; gap: 10px; width: 100%; padding: 12px;
    margin-top: 5px; background: rgba(255,255,255,0.05); cursor: pointer;
    border: 1px solid rgba(255,255,255,0.1); color: #fff; transition: 0.3s;
}
.layer-btn:hover, .layer-btn.active { background: rgba(255,255,255,0.15); border-color: currentColor; }

/* Colores */
.btn-flora.active { color: #69f0ae; border-color: #69f0ae; }
.btn-fauna.active { color: #00f3ff; border-color: #00f3ff; }
.btn-sacred.active { color: #ff0055; border-color: #ff0055; }
.dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; box-shadow: 0 0 10px currentColor; }
.sacred-dot { background: #ff0055; box-shadow: 0 0 10px #ff0055; }
        
</style>

    <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
  }
</script>
    
</head>
<body>

    <div id="cursor"><span id="cursor-text"></span></div>
    <canvas id="global-canvas"></canvas>

    <!-- LOADER -->
    <div class="loader" id="loader">
        <div class="font-tech text-xl tracking-[0.3em] text-[#D4A056] mb-4">WAYUU</div>
        <div class="w-48 h-[1px] bg-white/10 rounded overflow-hidden">
            <div class="loader-line h-full" id="loader-bar"></div>
        </div>
    </div>
    
    <!-- AUDIO DE FONDO -->
    <audio id="bg-music" loop>
        <source src="../../musica/musica_wayuu.wav" type="audio/wav">
    </audio>

    <!-- NAV BAR -->
  <!-- NAV BAR (Fija) -->
<nav class="fixed top-8 left-8 right-8 z-[100] flex justify-between items-center mix-blend-difference text-white">
    
    <!-- GRUPO IZQUIERDA: Logo + Volver -->
    <div class="flex items-center gap-6 md:gap-8">
        
        <!-- Logo -->
        <div class="text-xs font-tech tracking-[0.3em] cursor-pointer hover-trigger" id="logo-btn">
            NACIÓN WAYUU
        </div>

        <!-- Separador Vertical (Sutil) -->
        <div class="h-4 w-[1px] bg-white/20 hidden md:block"></div>

        <!-- BOTÓN VOLVER (Premium) -->
        <!-- hover-trigger: Para que el cursor reaccione -->
        <a href="javascript:history.back()" class="hover-trigger group flex items-center gap-3 text-[10px] font-mono tracking-widest text-white/60 hover:text-[#C89F65] transition-colors duration-300">
            <!-- Flecha animada -->
            <span class="transform group-hover:-translate-x-1 transition-transform duration-300 text-lg leading-none pb-1">←</span>
            <span class="uppercase">Volver al Globo</span>
        </a>

    </div>

    <!-- GRUPO DERECHA: Sonido + Menú -->
    <div class="flex items-center gap-6">
        
        <!-- BOTÓN SONIDO -->
        <button id="sound-btn" class="hover-trigger group flex items-center gap-2 uppercase text-[10px] tracking-widest cursor-pointer">
            <span id="sound-text" class="hidden md:block opacity-50 group-hover:opacity-100 transition-opacity">Sound Off</span>
            <div class="w-10 h-10 border border-white/30 rounded-full flex items-center justify-center group-hover:bg-white group-hover:text-black transition-all">
                <svg id="icon-mute" width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>
                <svg id="icon-sound" class="hidden" width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>
            </div>
        </button>

        <!-- BOTÓN MENÚ -->
        <button id="menu-btn" class="hover-trigger group flex items-center gap-2 uppercase text-[10px] tracking-widest cursor-pointer">
            <span class="hidden md:block opacity-50 group-hover:opacity-100 transition-opacity">Menú</span>
            <div class="w-10 h-10 border border-white/30 rounded-full flex items-center justify-center group-hover:bg-white group-hover:text-black transition-all relative overflow-hidden">
                <div id="hamburger-line" class="w-4 h-[1px] bg-current transition-all duration-300"></div>
                <div id="close-x" class="absolute inset-0 flex items-center justify-center opacity-0 scale-50 transition-all duration-300"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg></div>
            </div>
        </button>

    </div>
</nav>
    </nav>

    <!-- OVERLAY MENÚ -->
    <div id="menu-overlay" class="fixed inset-0 bg-[#050200] z-[90] hidden flex flex-col justify-center items-center opacity-0 transition-opacity duration-500">
        <ul class="text-center space-y-4 md:space-y-8">
            <li><a href="#main-content" class="menu-link block text-5xl md:text-7xl font-display text-white hover:text-[#C89F65] transition-colors translate-y-10 opacity-0">Origen</a></li>
            <li><a href="#identity-section" class="menu-link block text-5xl md:text-7xl font-display text-white hover:text-[#C89F65] transition-colors translate-y-10 opacity-0">Identidad</a></li>
            <li><a href="#weaving-container" class="menu-link block text-5xl md:text-7xl font-display text-white hover:text-[#C89F65] transition-colors translate-y-10 opacity-0">El Tejido</a></li>
            <li><a href=".desert-bg" class="menu-link block text-5xl md:text-7xl font-display text-white hover:text-[#C89F65] transition-colors translate-y-10 opacity-0">Wayuunaiki</a></li>
            <li><a href="#jepira-section" class="menu-link block text-5xl md:text-7xl font-display text-white hover:text-[#C89F65] transition-colors translate-y-10 opacity-0">Jepira</a></li>
        </ul>
        <div class="absolute bottom-10 text-center opacity-50"><p class="text-[10px] font-mono tracking-[0.3em] text-white">NACIÓN WAYUU — 2025</p></div>
    </div>

    <!-- MAIN -->
    <main id="main-content">
        
        <!-- 1. HERO -->
        <section class="relative h-screen flex items-center justify-center overflow-hidden">
            <video autoplay muted loop playsinline class="hero-video-bg"><source src="https://pub-fafba38564814a0f9795e9a424b79815.r2.dev/video/wayuu_desierto_ss.mp4" type="video/mp4"></video>
            <div class="text-center relative z-10 flex flex-col items-center">
                <p class="font-tech text-xs tracking-[0.8em] text-white/60 mb-6 reveal-text">ORIGEN</p>
                <h1 class="giant-text font-display reveal-title">WA<span>YUU</span></h1>
                <p class="mt-8 text-sm md:text-lg text-white/80 font-light tracking-widest max-w-md reveal-text uppercase">Hijos de la lluvia y la sequía</p>
                <p class="mt-8 text-sm md:text-lg text-white/80 font-light tracking-widest max-w-md reveal-text uppercase">EL CAMINO DE LAS ALMAS</p>
            </div>
            <div class="absolute bottom-10 animate-bounce z-20 text-white/50">
                <p class="text-[9px] tracking-[0.3em] mb-2 uppercase">Descubre su historia</p>
                <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
            </div>
        </section>

        <!-- 2. IDENTIDAD (SCROLL HORIZONTAL) -->
        <section id="identity-section" class="overflow-hidden h-screen bg-[#050200] relative z-20">
            <div class="horizontal-container" id="horizontal-wrapper">
                
                <div class="panel bg-black relative">
                    <div class="z-10 max-w-2xl px-6">
                        <span class="text-[#FF3B3B] font-mono text-xs tracking-widest mb-4 block">01 — IDENTIDAD</span>
                        <h2 class="text-5xl md:text-8xl font-display text-white mb-8">Los 4 Pilares <br><span class="italic text-[#C89F65]">Ancestrales</span></h2>
                        <p class="text-gray-400 text-lg font-light">Más que una etnia, somos una civilización del desierto.<br><br><span class="text-xs font-mono border-b border-gray-600 pb-1 animate-pulse">DESLIZA ▶</span></p>
                    </div>
                    <div class="panel-fade"></div>
                </div>

                <div class="panel hover-trigger group relative">
                    <div class="absolute inset-0 w-full h-full">
                        <video autoplay muted loop playsinline class="cinematic-video"><source src="https://pub-fafba38564814a0f9795e9a424b79815.r2.dev/video/wayuu-rojas2.mp4" type="video/mp4"></video>
                        <div class="text-protection"></div><div class="panel-fade"></div>
                    </div>
                    <div class="glass-card p-10 max-w-xl z-20 relative backdrop-blur-md border border-white/10">
                        <h3 class="text-4xl font-display text-white mb-4">La Sangre Materna</h3>
                        <p class="text-gray-200 font-light mb-4 text-lg">Sociedad <strong class="text-[#C89F65]">Matrilineal</strong>. El apellido y el clan (*Eiruku*) se heredan de la madre. Ella es la raíz.</p>
                        <ul class="text-xs font-mono text-gray-300 space-y-2 border-t border-white/20 pt-4"><li>• Eiruku: Carne / Clan</li><li>• 30+ Clanes (Uriana, Epieyu...)</li></ul>
                    </div>
                </div>

                <div class="panel hover-trigger group relative">
                    <div class="absolute inset-0 w-full h-full">
                        <video autoplay muted loop playsinline class="cinematic-video"><source src="https://pub-fafba38564814a0f9795e9a424b79815.r2.dev/video/wayuu_video.mp4" type="video/mp4"></video>
                        <div class="text-protection"></div><div class="panel-fade"></div>
                    </div>
                    <div class="glass-card p-10 max-w-xl z-20 relative backdrop-blur-md border border-white/10">
                        <h3 class="text-4xl font-display text-white mb-4">La Palabra es Ley</h3>
                        <p class="text-gray-200 font-light mb-4 text-lg">El <strong class="text-[#C89F65]">Pütchipü'ü</strong> (Palabrero) resuelve conflictos con el poder de la palabra, evitando la guerra y restaurando la armonía.</p>
                        <span class="text-xs uppercase tracking-widest text-[#C89F65]">Patrimonio de la Humanidad</span>
                    </div>
                </div>

                <div class="panel hover-trigger group relative">
                    <div class="absolute inset-0 w-full h-full">
                        <video autoplay muted loop playsinline class="cinematic-video"><source src="https://pub-fafba38564814a0f9795e9a424b79815.r2.dev/video/default_video.mp4" type="video/mp4"></video>
                        <div class="text-protection"></div><div class="panel-fade"></div>
                    </div>
                    <div class="glass-card p-10 max-w-xl z-20 relative backdrop-blur-md border border-white/10">
                        <h3 class="text-4xl font-display text-white mb-4">Sustento y Arte</h3>
                        <p class="text-gray-200 font-light mb-4 text-lg">Pastoreo, pesca y tejido. Cada mochila (*Susu*) cuenta una historia geométrica (*Kanas*) que refleja el universo Wayuu.</p>
                        <span class="text-[#C89F65] text-4xl font-bold block mt-4">Kanas <span class="text-sm font-normal text-white">Geometría Sagrada</span></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. EL HILO DE LA VIDA -->
        <section class="h-screen w-full flex flex-col md:flex-row items-center justify-center relative bg-[#050200] overflow-hidden z-20">
            <div class="absolute md:relative z-30 w-full md:w-1/3 px-8 md:pl-24 text-center md:text-left pointer-events-none mix-blend-difference">
                <span class="text-[#C89F65] font-mono text-xs tracking-widest uppercase mb-4 block">02 — El hilo de la vida</span>
                <span class="text-[#FF3B3B] text-xs font-mono tracking-[0.4em] uppercase mb-4 block">Wale'kerü</span>
                <h3 class="text-4xl md:text-6xl font-display text-white mb-6">El Tejido es <br><span class="italic text-[#C89F65]">Pensamiento</span></h3>
                <p class="text-sm text-gray-300 font-light leading-relaxed max-w-md mx-auto md:mx-0">"La araña nos enseñó que tejer no es solo cruzar hilos. Es organizar la vida. Cada nudo es una familia, cada línea un camino."</p>
                <div class="mt-8 flex items-center justify-center md:justify-start gap-4 opacity-70">
                    <span class="text-[10px] tracking-widest uppercase">Interactúa con la red</span>
                </div>
            </div>
            <div id="weaving-container" class="absolute inset-0 md:relative md:w-2/3 h-full cursor-grab active:cursor-grabbing z-20 opacity-60 md:opacity-100"></div>
         </section>


        <!-- 4. OBSERVATORIO TERRITORIAL (NUEVO) -->
<section id="observatory" class="h-screen w-full relative flex items-center justify-center bg-[#050200] overflow-hidden z-20">
    <!-- Fondo sutil estático para no cargar más 3D -->
    <div class="absolute inset-0 opacity-20 bg-[url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1920')] bg-cover bg-center grayscale mix-blend-screen pointer-events-none"></div>

    <div class="relative z-30 flex flex-col items-center justify-center w-full px-4">
        <span class="text-[#00f3ff] font-mono text-xs tracking-[0.3em] mb-12 animate-pulse text-center block">SISTEMA DE BIO-ESCANEO</span>
        
        <!-- EL RADAR -->
        <div class="radar-container hover-trigger" onclick="openMapModal()">
           <div class="orbit-track">
    <!-- Icono 1: Flora -->
    <div class="orbit-icon-wrapper pos-wrapper-1" style="position: absolute; top: 0; left: 50%; transform: translate(-50%, -50%);">
        <div class="orbit-icon" style="width: 40px; height: 40px; background: #000; border: 1px solid var(--c-cyan); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: var(--c-cyan); box-shadow: 0 0 10px var(--c-cyan); margin-bottom: 5px;">
            <span id="icon-flora" class="material-symbols-rounded">cactus</span>
        </div>
        <div class="orbit-label" style="font-family: 'Syncopate', sans-serif; font-size: 8px; color: var(--c-cyan); letter-spacing: 1px; text-align: center;">FLORA</div>
    </div>

    <!-- Icono 2: Fauna -->
    <div class="orbit-icon-wrapper pos-wrapper-2" style="position: absolute; bottom: 15%; right: 15%;">
        <div class="orbit-icon" style="width: 40px; height: 40px; background: #000; border: 1px solid var(--c-cyan); border-radius: 50%; display: flex; justify-content: center; align-items: center; color: var(--c-cyan); box-shadow: 0 0 10px var(--c-cyan); margin-bottom: 5px;">
            <span id="icon-fauna" class="material-symbols-rounded">pets</span>
        </div>
        <div class="orbit-label" style="font-family: 'Syncopate', sans-serif; font-size: 8px; color: var(--c-cyan); letter-spacing: 1px; text-align: center;">FAUNA</div>
    </div>

    <!-- Icono 3: Sagrado -->
    <div class="orbit-icon-wrapper pos-wrapper-3" style="position: absolute; bottom: 15%; left: 15%;">
        <div class="orbit-icon" style="width: 40px; height: 40px; background: #000; border: 1px solid #ff0055; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: #ff0055; box-shadow: 0 0 10px #ff0055; margin-bottom: 5px;">
            <span id="icon-sacred" class="material-symbols-rounded">temple_buddhist</span>
        </div>
        <div class="orbit-label" style="font-family: 'Syncopate', sans-serif; font-size: 8px; color: #ff0055; letter-spacing: 1px; text-align: center;">SAGRADO</div>
    </div>
</div>
            
            <div class="radar-ring ring-1"></div>
            <div class="radar-ring ring-2"></div>
            
            <div class="radar-core group">
                <span class="material-symbols-rounded text-4xl text-[#00f3ff] group-hover:text-white transition-colors">public</span>
                <span class="text-[10px] text-[#00f3ff] mt-2 font-mono tracking-widest group-hover:text-white">ABRIR SATÉLITE</span>
            </div>
        </div>

        <p class="mt-16 text-gray-400 text-sm font-light max-w-md text-center leading-relaxed">
            Visualiza el terreno real, biodiversidad y zonas protegidas.
        </p>
    </div>
</section>
        
        <!-- 5. VOCES DEL VIENTO -->
        <section class="py-32 px-6 md:px-12 relative overflow-hidden h-auto min-h-screen flex flex-col justify-center">
            <img src="../../img/wayuu_desierto.jpeg" alt="Desierto" class="desert-bg">
            <div class="desert-overlay"></div>
           <div class="cinematic-fade" style="z-index: 20;"></div>
            
            <div class="max-w-[1400px] mx-auto w-full relative cards-container">
                <div class="mb-16 border-l-2 border-[#C89F65] pl-6 relative z-30">
                    <p class="text-[#C89F65] font-mono text-xs tracking-widest mb-2 shadow-black drop-shadow-md">03 — WAYUUNAIKI</p>
                    <h2 class="text-4xl md:text-6xl font-display text-white drop-shadow-2x1">El Idioma del <span class="italic text-[#C89F65] brightness-125">Desierto</span></h2>
                </div>
        
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 relative z-30">
                    <!-- Tarjeta 1 -->
                    <div id="card-audio1" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio1')">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-12 h-8">
                                <div class="flex items-end gap-2 h-full"><span class="text-xs font-mono text-gray-300 mb-1">01</span><div id="eq-audio1" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300"><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div></div></div>
                                <div id="btn-audio1" class="play-btn"><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
                            </div>
                            <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Achonnii</h3>
                            <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/a-cho-nii/ — "Hijo"</p>
                        </div>
                        <audio id="audio1" src="../../vocabulario/wayuu/achonnii.mp3"></audio>
                    </div>
                    <!-- Tarjeta 2 -->
                    <div id="card-audio2" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio2')">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-12 h-8">
                                <div class="flex items-end gap-2 h-full"><span class="text-xs font-mono text-gray-300 mb-1">02</span><div id="eq-audio2" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300"><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div></div></div>
                                <div id="btn-audio2" class="play-btn"><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
                            </div>
                            <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Eyüü</h3>
                            <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/e-yüü/ — "Madre"</p>
                        </div>
                        <audio id="audio2" src="../../vocabulario/wayuu/eyuu.mp3"></audio>
                    </div>
                    <!-- Tarjeta 3 -->
                    <div id="card-audio3" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio3')">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-12 h-8">
                                <div class="flex items-end gap-2 h-full"><span class="text-xs font-mono text-gray-300 mb-1">03</span><div id="eq-audio3" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300"><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div></div></div>
                                <div id="btn-audio3" class="play-btn"><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
                            </div>
                            <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Aa, anayawatsi</h3>
                            <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/Aa-a-na-ya-wat-si/ — "Sí, gracias"</p>
                        </div>
                        <audio id="audio3" src="../../vocabulario/wayuu/aaanayaguatsi.mp3"></audio>
                    </div>
                    <!-- Tarjeta 4 -->
                    <div id="card-audio4" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio4')">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-12 h-8">
                                <div class="flex items-end gap-2 h-full"><span class="text-xs font-mono text-gray-300 mb-1">04</span><div id="eq-audio4" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300"><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div></div></div>
                                <div id="btn-audio4" class="play-btn"><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
                            </div>
                            <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Anayawatsi ma'in</h3>
                            <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/A-na-ya-wat-si-main/ — "Muchas gracias"</p>
                        </div>
                        <audio id="audio4" src="../../vocabulario/wayuu/anayaquatsi.mp3"></audio>
                    </div>
                    <!-- Tarjeta 5 -->
                    <div id="card-audio5" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio5')">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-12 h-8">
                                <div class="flex items-end gap-2 h-full"><span class="text-xs font-mono text-gray-300 mb-1">05</span><div id="eq-audio5" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300"><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div></div></div>
                                <div id="btn-audio5" class="play-btn"><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
                            </div>
                            <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Wattama'at</h3>
                            <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/Wa-tta-ma-at/ — "Es de mañana"</p>
                        </div>
                        <audio id="audio5" src="../../vocabulario/wayuu/guattamaat.mp3"></audio>
                    </div>
                    <!-- Tarjeta 6 -->
                    <div id="card-audio6" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio6')">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-12 h-8">
                                <div class="flex items-end gap-2 h-full"><span class="text-xs font-mono text-gray-300 mb-1">06</span><div id="eq-audio6" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300"><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div></div></div>
                                <div id="btn-audio6" class="play-btn"><svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
                            </div>
                            <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Paliijü taya</h3>
                            <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/Pa-lii-jü-ta-ya/ — "Por favor"</p>
                        </div>
                        <audio id="audio6" src="../../vocabulario/wayuu/paliijiu.mp3"></audio>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. LAPÜ -->
        <section id="lapu-section" class="relative h-screen w-full bg-[#020202] overflow-hidden flex items-center justify-center cursor-none z-20">
            <div id="dream-canvas-container" class="absolute inset-0 z-0"></div>
            <div class="relative z-10 text-center pointer-events-none mix-blend-exclusion px-4">
                <span class="text-xs font-tech text-[#FF3B3B] tracking-[0.5em] block mb-4">04 — LAPÜ (EL ORÁCULO)</span>
                <h2 class="text-3xl md:text-5xl font-display text-white mb-6">El Sueño es la <br>verdadera vigilia</h2>
                <div class="inline-flex flex-col items-center gap-2 mt-[30vh] opacity-60 animate-pulse">
                    <div class="w-[1px] h-12 bg-white"></div>
                    <p class="text-white text-[10px] font-mono tracking-widest uppercase">Disipa la niebla para recibir el mensaje</p>
                </div>
            </div>
        </section>

        <!-- 7. VIDEO (YOUTUBE LOOP PERFECTO + FADE) -->
        <section class="relative h-screen flex items-center justify-center overflow-hidden bg-[#050200] video-cursor-area">
            <!-- Contenedor API YouTube -->
            <div id="yonna-player" class="absolute w-full h-full object-cover opacity-70 pointer-events-none scale-125 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-0"></div>
            <div class="cinematic-fade" style="z-index: 20;"></div>
            <div class="relative z-30 text-center mix-blend-overlay px-4 pointer-events-none">
                <h2 class="text-[12vw] font-display text-white leading-none tracking-tighter">RITUAL</h2>
                <p class="text-white text-xl font-light italic mt-4">La Yonna</p>
            </div>
        </section>     

        <!-- 8. JEPIRA (WARP SPEED + FONDO) -->
        <section id="jepira-section" class="min-h-screen flex flex-col items-center justify-center relative">
            <div id="cosmos-overlay" class="cosmos-bg"></div>
            <div class="relative z-10 text-center px-6 max-w-3xl">
                <span class="text-[#A5D8FF] text-xs font-mono mb-6 block tracking-widest">05 — JEPIRA</span>
                <h2 class="text-5xl md:text-7xl font-display text-white mb-8">El Camino de las Almas</h2>
                 <p class="text-gray-300 text-lg font-light leading-relaxed mb-12 max-w-lg mx-auto">
                     En la cosmovisión Wayuu, la muerte no es el final. Es un viaje hacia Jepira (Cabo de la Vela), el lugar donde habitan los muertos. Allí, las almas (Yoluja) esperan para convertirse en lluvia o en estrellas de la Vía Láctea (Spieyu).
                 </p>
                <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="px-10 py-4 border border-white/30 rounded-full text-xs font-bold uppercase tracking-widest text-white hover:bg-white hover:text-black transition-all hover-trigger bg-black/50 backdrop-blur-md">
                    Regresar a la Tierra
                </button>
            </div>
        </section>
        
        <!-- FOOTER -->
        <footer class="bg-[#050200] pt-24 pb-12 px-6 border-t border-white/5 relative z-20">
            <div class="max-w-7xl mx-auto">
                <div class="grid grid-cols-1 md:grid-cols-12 gap-12 mb-20">
                    <div class="md:col-span-5 flex flex-col justify-between h-full">
                        <div>
                            <img src="../../img/Logo.png" alt="Logo Ululato" class="w-16 mb-8 opacity-80 hover:opacity-100 transition-opacity">
                            <h2 class="text-3xl md:text-4xl font-display text-white leading-tight">Preservando la <br> <span class="text-[#C89F65] italic">memoria ancestral</span> <br> en el código digital.</h2>
                        </div>
                    </div>
                    <div class="md:col-span-3 md:col-start-7">
                        <span class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-6 block">Explorar</span>
                        <ul class="space-y-4">
                            <li><a href="#main-content" class="footer-link text-gray-300 hover:text-[#C89F65] transition-colors text-sm uppercase tracking-wider font-light">Origen</a></li>
                            <li><a href="#identity-section" class="footer-link text-gray-300 hover:text-[#C89F65] transition-colors text-sm uppercase tracking-wider font-light">Identidad</a></li>
                            <li><a href="#weaving-container" class="footer-link text-gray-300 hover:text-[#C89F65] transition-colors text-sm uppercase tracking-wider font-light">El Tejido</a></li>
                            <li><a href=".desert-bg" class="footer-link text-gray-300 hover:text-[#C89F65] transition-colors text-sm uppercase tracking-wider font-light">Wayuunaiki</a></li>
                            <li><a href="#jepira-section" class="footer-link text-gray-300 hover:text-[#C89F65] transition-colors text-sm uppercase tracking-wider font-light">Jepira</a></li>
                        </ul>
                    </div>
                    <div class="md:col-span-3">
                        <span class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-6 block">Conectar</span>
                        <ul class="space-y-4">
                            <li><a href="#" class="group flex items-center gap-2 text-gray-300 hover:text-white transition-colors"><span class="text-sm">Instagram</span></a></li>
                            <li><a href="#" class="group flex items-center gap-2 text-gray-300 hover:text-white transition-colors"><span class="text-sm">Twitter / X</span></a></li>
                        </ul>
                    </div>
                </div>
                <div class="border-t border-white/10 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                    <p class="font-tech text-[10px] text-gray-600 tracking-[0.2em]">© 2025 PROYECTO ULULATO</p>
                </div>
            </div>
        </footer>
    </main>

     <!-- MODAL MAPBOX (FULLSCREEN OVERLAY) -->
<div id="mapbox-modal">
    <button class="absolute top-8 right-8 z-[2001] text-white hover:text-[#00f3ff] transition-colors flex items-center gap-2 bg-black/50 px-6 py-3 rounded-full backdrop-blur-md border border-white/20 hover:border-[#00f3ff]" onclick="closeMapModal()">
        <span class="text-xs font-mono tracking-widest uppercase">Cerrar Mapa</span>
        <span class="material-symbols-rounded">close</span>
    </button>
    
    <div id="map-container"></div>
    
    <div class="map-hud">
        <h3 class="text-[#00f3ff] font-display text-xl mb-2">Datos Territoriales</h3>
        <p class="text-xs text-gray-400 mb-4">Capas de densidad en tiempo real.</p>
        
        <button class="layer-btn btn-flora active" onclick="toggleLayer('flora')">
            <span class="dot"></span> Flora (Cactus/Trupillo)
        </button>
        <button class="layer-btn btn-fauna" onclick="toggleLayer('fauna')">
            <span class="dot"></span> Fauna (Flamencos)
        </button>
       <button class="layer-btn btn-sacred" onclick="toggleLayer('sacred')">
       <span class="dot" style="background: #ff0055; box-shadow: 0 0 10px #ff0055;"></span> Territorios Sagrados
</button>
    </div>
</div>
    
    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.0/vanilla-tilt.min.js"></script>

    <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { pueblosData } from '../../data_pueblos.js'; 

    // ==========================================
    // 0. CONFIGURACIÓN GLOBAL
    // ==========================================
    let isGlobalAnimating = true; // Control de rendimiento (Pausa fondo al abrir mapa)
    let isAutoRotating = true;    // Control de rotación del mapa
    let map;                      // Instancia del mapa
    let lenis;                    // Smooth scroll
    let player;                   // Youtube Player

    // ==========================================
    // 1. CARGA DE DATOS
    // ==========================================
    const params = new URLSearchParams(window.location.search);
    const puebloId = params.get('id') || 'wayuu'; 
    
    // Guardamos data en variable global
    window.puebloData = pueblosData.find(p => p.id === puebloId) || pueblosData[0];
    
    console.log("Cargando:", window.puebloData.name);

    // --- INYECTAR DATOS EN EL DOM ---
    
    // 1.1 Textos Principales
    const navTitle = document.getElementById('pueblo-nav-title');
    if(navTitle) navTitle.textContent = "NACIÓN " + window.puebloData.name.toUpperCase();

    const titleEl = document.getElementById('pueblo-title');
    if(titleEl) {
        const name = window.puebloData.name;
        const splitName = name.length > 3 ? name.substring(0, 3) : name;
        const restName = name.length > 3 ? name.substring(3) : "";
        titleEl.innerHTML = `${splitName}<span>${restName}</span>`;
    }

    const subEl = document.getElementById('pueblo-subtitle');
    if(subEl) subEl.textContent = window.puebloData.region;

    const descEl = document.getElementById('culture-desc');
    if(descEl) descEl.textContent = window.puebloData.desc;

    // 1.2 Iconos del Radar Dinámicos
    // Si la data tiene iconos personalizados, los usamos. Si no, usamos defaults.
    const icons = window.puebloData.icons || { flora: 'cactus', fauna: 'pets', sacred: 'temple_buddhist' };
    
    const iconFlora = document.getElementById('icon-flora');
    if(iconFlora) iconFlora.textContent = icons.flora;
    
    const iconFauna = document.getElementById('icon-fauna');
    if(iconFauna) iconFauna.textContent = icons.fauna;
    
    const iconSacred = document.getElementById('icon-sacred');
    if(iconSacred) iconSacred.textContent = icons.sacred;

    // 1.3 Video Hero de Fondo
    const videoHero = document.getElementById('hero-video');
    // Usamos video de la data o uno por defecto
    const videoSrc = window.puebloData.video || "https://pub-fafba38564814a0f9795e9a424b79815.r2.dev/video/wayuu_desierto_ss.mp4";
    
    if(videoHero) {
        const source = videoHero.querySelector('source');
        if(source) source.src = videoSrc;
        else videoHero.src = videoSrc;
        videoHero.load();
    }


    // ==========================================
    // 2. MAPBOX (OBSERVATORIO)
    // ==========================================
    mapboxgl.accessToken = 'pk.eyJ1IjoidmlydHVhbGEiLCJhIjoiY21ranRzb2ZjMTlsYTNlcHpxZHNoNWM1dyJ9.9HAi74i0jwxPX-FckHFOoQ';

    window.openMapModal = function() {
        document.getElementById('mapbox-modal').classList.add('open');
        isGlobalAnimating = false; // Pausar fondo para ahorrar recursos
        
        if (!map) {
            setTimeout(() => initMap(), 500); 
        }
    };

    window.closeMapModal = function() {
        document.getElementById('mapbox-modal').classList.remove('open');
        isGlobalAnimating = true; // Reanudar fondo
    };

    function initMap() {
        if(map) return;

        const lng = window.puebloData.lon || -71.80; 
        const lat = window.puebloData.lat || 11.95;

        map = new mapboxgl.Map({
            container: 'map-container',
            style: 'mapbox://styles/mapbox/satellite-streets-v12', // VISTA REAL
            center: [lng, lat],
            zoom: 9, 
            pitch: 60, 
            bearing: -20, 
            projection: 'globe',
            maxZoom: 16,     // Limite para que no se vea borroso
            dragPan: true,   // Mover con mouse/dedo
            scrollZoom: true,
            touchZoomRotate: true
        });

        // Controles de Zoom (+ / -)
        map.addControl(new mapboxgl.NavigationControl(), 'bottom-right');

        // Detener rotación si el usuario toca
        const stopRotation = () => { isAutoRotating = false; };
        map.on('mousedown', stopRotation);
        map.on('touchstart', stopRotation);
        map.on('wheel', stopRotation);
        map.on('dragstart', stopRotation);

        map.on('style.load', () => {
            // Terreno 3D
            map.addSource('mapbox-dem', { 'type': 'raster-dem', 'url': 'mapbox://mapbox.mapbox-terrain-dem-v1', 'tileSize': 512, 'maxzoom': 14 });
            map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });
            map.setFog({ 'range': [0.5, 10], 'color': '#050200', 'horizon-blend': 0.1 });

            // Generar Puntos
            const floraData = generateRandomPoints(lng, lat, 400, 0.2); 
            const faunaData = generateRandomPoints(lng, lat, 300, 0.3); 
            const sacredData = generateRandomPoints(lng + 0.05, lat + 0.05, 150, 0.05);

            // Capas
            addHeatmapLayer('flora', floraData, '#69f0ae', '#00ff00');
            addHeatmapLayer('fauna', faunaData, '#00f3ff', '#0044ff');
            addHeatmapLayer('sacred', sacredData, '#ff0055', '#ffaa00');

            // Estado Inicial
            window.toggleLayer('flora');
            rotateCamera();
        });
    }

    function rotateCamera() {
        if (map && isAutoRotating) {
            const currentBearing = map.getBearing();
            map.easeTo({ bearing: currentBearing + 0.05, duration: 0, easing: t => t });
            requestAnimationFrame(rotateCamera);
        }
    }

    // Toggle Capas
    window.toggleLayer = function(layer) {
        if(!map) return;
        document.querySelectorAll('.layer-btn').forEach(b => b.classList.remove('active'));
        
        ['flora', 'fauna', 'sacred'].forEach(l => {
             if(map.getLayer(`${l}-heat`)) map.setLayoutProperty(`${l}-heat`, 'visibility', 'none');
        });
        
        if(map.getLayer(`${layer}-heat`)) {
            map.setLayoutProperty(`${layer}-heat`, 'visibility', 'visible');
            const btn = document.querySelector(`.btn-${layer}`);
            if(btn) btn.classList.add('active');
        }
    };

    // Helpers Mapbox
    function generateRandomPoints(cx, cy, count, spread) {
        const points = [];
        for(let i=0; i<count; i++) {
            points.push({ "type": "Feature", "properties": { "density": Math.random() }, "geometry": { "type": "Point", "coordinates": [cx + (Math.random()-0.5)*spread, cy + (Math.random()-0.5)*spread] } });
        }
        return { "type": "FeatureCollection", "features": points };
    }

    function addHeatmapLayer(id, data, c1, c2) {
        map.addSource(id, { type: 'geojson', data: data });
        map.addLayer({
            id: `${id}-heat`, type: 'heatmap', source: id, layout: { 'visibility': 'none' },
            paint: {
                'heatmap-weight': ['interpolate', ['linear'], ['get', 'density'], 0, 0, 1, 2],
                'heatmap-intensity': 2, 
                'heatmap-color': ['interpolate', ['linear'], ['heatmap-density'], 0, 'rgba(0,0,0,0)', 0.2, c1, 1, c2],
                'heatmap-radius': 30, 'heatmap-opacity': 0.8
            }
        });
    }


    // ==========================================
    // 3. FUNCIONES VISUALES Y AUDIO
    // ==========================================

    // LOADER (Para quitar la pantalla negra al inicio)
    window.addEventListener('load', () => {
        const loader = document.getElementById('loader');
        if(loader) {
            gsap.to(loader, { opacity: 0, duration: 1, onComplete: () => loader.style.display = 'none' });
            document.getElementById('main-content').style.opacity = 1;
            document.getElementById('global-canvas').style.opacity = 1;
            
            // Animaciones de entrada
            gsap.from(".reveal-title", { y: 100, opacity: 0, duration: 1.5, ease: "power4.out" });
            gsap.from(".reveal-text", { y: 30, opacity: 0, duration: 1, stagger: 0.2 });
        }
    });

    // Audio Player Individual
    window.playRealAudio = function(id) {
        const targetAudio = document.getElementById(id);
        const btn = document.getElementById(`btn-${id}`);
        // Verifica si los elementos existen para evitar errores
        if (!targetAudio || !btn) return;

        const playIcon = '<span class="material-symbols-rounded">play_arrow</span>';
        const pauseIcon = '<span class="material-symbols-rounded">pause</span>';

        if (!targetAudio.paused) {
            targetAudio.pause();
            btn.innerHTML = playIcon;
            return;
        }

        // Pausar otros
        document.querySelectorAll('audio').forEach(a => {
            if(a.id !== 'bg-music' && a !== targetAudio) {
                a.pause(); a.currentTime = 0;
            }
        });
        // Reset visual de otros botones
        document.querySelectorAll('.play-btn').forEach(b => b.innerHTML = playIcon);

        targetAudio.play();
        btn.innerHTML = pauseIcon;
        targetAudio.onended = () => { btn.innerHTML = playIcon; };
    };

    // Toggle Audio de Fondo
    const bgMusic = document.getElementById('bg-music');
    const soundBtn = document.getElementById('sound-btn');
    let isMusicPlaying = false;
    
    if(bgMusic && soundBtn) {
        bgMusic.volume = 0.4;
        soundBtn.addEventListener('click', () => {
            if(!isMusicPlaying) {
                bgMusic.play().then(() => { isMusicPlaying = true; soundBtn.innerText = "SONIDO ON"; });
            } else {
                bgMusic.pause(); isMusicPlaying = false; soundBtn.innerText = "SONIDO OFF";
            }
        });
    }


    // ==========================================
    // 4. THREE.JS (FONDO Y TEJIDO)
    // ==========================================

    // Fondo de Partículas (Túnel)
    const initGlobalThree = () => {
        const canvas = document.getElementById('global-canvas');
        if(!canvas) return;
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050200, 0.0015);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
        camera.position.z = 1000;
        const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

        const count = 4000; 
        const geo = new THREE.BufferGeometry();
        const pos = new Float32Array(count*3);
        for(let i=0; i<count*3; i+=3) { pos[i]=(Math.random()-0.5)*2500; pos[i+1]=(Math.random()-0.5)*2500; pos[i+2]=(Math.random()-0.5)*4000; }
        geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
        const mat = new THREE.PointsMaterial({ size: 2, color: 0xC89F65, transparent: true, opacity: 0.8 });
        const particles = new THREE.Points(geo, mat);
        scene.add(particles);

        const animate = () => {
            // SOLO ANIMAR SI EL MAPA NO ESTÁ ABIERTO (Optimización)
            if(isGlobalAnimating) {
                const p = geo.attributes.position.array;
                for(let i=0; i<count; i++) {
                    const i3 = i*3; p[i3+2] += 2; 
                    if(p[i3+2] > 1000) p[i3+2] = -3000;
                }
                geo.attributes.position.needsUpdate = true;
                renderer.render(scene, camera);
            }
            requestAnimationFrame(animate);
        };
        animate();
        window.addEventListener('resize', () => { 
            camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); 
            renderer.setSize(window.innerWidth, window.innerHeight); 
        });
    };
    initGlobalThree();

    // Tejido 3D (Weaving)
    (function() {
        const container = document.getElementById('weaving-container');
        if(!container) return;
        const scene = new THREE.Scene(); scene.fog = new THREE.FogExp2(0x050200, 0.002);
        const camera = new THREE.PerspectiveCamera(75, container.clientWidth/container.clientHeight, 0.1, 1000);
        camera.position.z = 15;
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);
        
        const geo = new THREE.IcosahedronGeometry(7, 1);
        const mat = new THREE.MeshBasicMaterial({ color: 0xFF3B3B, wireframe: true, transparent: true, opacity: 0.3 });
        const sphere = new THREE.Mesh(geo, mat);
        scene.add(sphere);

        const animate = () => {
            if(isGlobalAnimating) { 
                sphere.rotation.y += 0.002;
                renderer.render(scene, camera);
            }
            requestAnimationFrame(animate);
        };
        animate();
    })();

    // ==========================================
    // 5. EFECTOS UI (CURSOR, SCROLL, TILT)
    // ==========================================

    // Scroll Horizontal
    gsap.registerPlugin(ScrollTrigger);
    const panels = gsap.utils.toArray(".panel");
    const containerH = document.getElementById("horizontal-wrapper");
    if(panels.length > 0 && containerH) {
        gsap.to(panels, {
            xPercent: -100 * (panels.length - 1), ease: "none",
            scrollTrigger: {
                trigger: "#identity-section", pin: true, scrub: 1,
                snap: 1 / (panels.length - 1), end: () => "+=" + containerH.offsetWidth
            }
        });
    }

    // Efecto Jepira (Fondo cósmico)
    if(document.getElementById('cosmos-overlay')) {
        ScrollTrigger.create({
            trigger: "#jepira-section", start: "top center",
            onEnter: () => gsap.to("#cosmos-overlay", {opacity: 1, duration: 2}),
            onLeaveBack: () => gsap.to("#cosmos-overlay", {opacity: 0, duration: 2})
        });
    }

    // Cursor
    const cursor = document.getElementById('cursor');
    window.addEventListener('mousemove', e => {
        gsap.to(cursor, { x: e.clientX, y: e.clientY, duration: 0.1 });
    });
    window.addEventListener('touchmove', e => {
        const touch = e.touches[0];
        gsap.to(cursor, { x: touch.clientX, y: touch.clientY, duration: 0.1 });
    }, {passive: true});

    const radar = document.querySelector('.radar-container');
    if(radar) {
        radar.addEventListener('mouseenter', () => { cursor.classList.add('map-mode'); });
        radar.addEventListener('mouseleave', () => { cursor.classList.remove('map-mode'); });
    }

    document.querySelectorAll('.hover-trigger').forEach(el => {
        el.addEventListener('mouseenter', () => cursor.classList.add('hovered'));
        el.addEventListener('mouseleave', () => cursor.classList.remove('hovered'));
    });

    // Lenis Smooth Scroll
    if (typeof Lenis !== 'undefined') {
        lenis = new Lenis({ duration: 1.2 });
        function raf(time) { lenis.raf(time); requestAnimationFrame(raf); }
        requestAnimationFrame(raf);
        lenis.on('scroll', ScrollTrigger.update);
    }

    // Tilt Cards
    if (typeof VanillaTilt !== 'undefined') {
         VanillaTilt.init(document.querySelectorAll(".tilt-card"), { max: 10, speed: 400, glare: true, "max-glare": 0.2 });
    }

</script>
    
</body>
</html>
