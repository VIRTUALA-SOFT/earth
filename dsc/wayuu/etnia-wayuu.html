<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nación Wayuu | El Tejido de los Sueños</title>
    
    <!-- FUENTES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Syncopate:wght@400;700&family=Manrope:wght@200;300;400;500&display=swap" rel="stylesheet">
    
    <!-- LIBRERÍAS EXTERNAS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    
    <style>
        :root {
            --c-bg: #050200;
            --c-sand: #C89F65;
            --c-accent: #FF3B3B;
            --c-star: #A5D8FF;
        }

        body { 
            background-color: var(--c-bg); 
            color: #f3f3f3; 
            font-family: 'Manrope', sans-serif; 
            overflow-x: hidden; 
            cursor: none; 
            margin: 0;
        }

        .font-display { font-family: 'Playfair Display', serif; }
        .font-decor { font-family: 'Cinzel Decorative', serif; }
        .font-tech { font-family: 'Syncopate', sans-serif; }

        /* CURSOR */
        #cursor {
            position: fixed; top: 0; left: 0; width: 20px; height: 20px;
            border: 1px solid rgba(255,255,255,0.6); border-radius: 50%;
            pointer-events: none; z-index: 10001;
            transform: translate(-50%, -50%); transition: width 0.3s cubic-bezier(0.19, 1, 0.22, 1), height 0.3s cubic-bezier(0.19, 1, 0.22, 1), background 0.3s;
            mix-blend-mode: difference;
            display: flex; justify-content: center; align-items: center;
        }
        #cursor span { opacity: 0; font-size: 10px; font-weight: bold; color: black; transition: opacity 0.2s; font-family: 'Syncopate', sans-serif;}
        
        #cursor.hovered { width: 50px; height: 50px; background: white; mix-blend-mode: difference; }
        #cursor.audio-mode { width: 80px; height: 80px; background: var(--c-sand); border-color: transparent; mix-blend-mode: normal; }
        #cursor.audio-mode span { opacity: 1; content: "OÍR"; color: black; }
        #cursor.video-mode { width: 90px; height: 90px; background: var(--c-accent); border-color: transparent; mix-blend-mode: normal; }
        #cursor.video-mode span { opacity: 1; color: white; }
        #cursor.dream-mode { width: 150px; height: 150px; background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%); border: none; mix-blend-mode: screen; }

        /* UTILIDADES VISUALES */
        #global-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; opacity: 0; }
        
        .giant-text {
            font-size: clamp(4rem, 15vw, 20rem); line-height: 0.8; color: transparent;
            -webkit-text-stroke: 1px rgba(255,255,255,0.3); mix-blend-mode: overlay;
        }
        .giant-text span { color: var(--c-sand); -webkit-text-stroke: 0; }

        .hero-video-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;
            opacity: 0.5; filter: contrast(1.1) brightness(0.8);
            mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
        }

        /* TILT CARDS (Mejoradas para visibilidad) */
        .tilt-card {
            background: rgba(20, 20, 20, 0.6); /* Fondo más visible */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15); /* Borde más visible */
            transform-style: preserve-3d;
            transform: perspective(1000px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            transition: border-color 0.3s;
        }
        .tilt-card:hover { border-color: var(--c-sand); }
        .tilt-inner { transform: translateZ(30px); }

        /* LOADER */
        .loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--c-bg); z-index: 10000;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
        }
        .loader-line {
            width: 0%; height: 2px; background: linear-gradient(90deg, var(--c-accent), var(--c-sand)); transition: width 0.2s linear;
        }

        .cosmos-bg {
            position: absolute; inset: 0; background: radial-gradient(circle at center, #0B1026 0%, #000000 100%);
            opacity: 0; transition: opacity 1.5s ease; pointer-events: none;
        }
        
        /* Botón Play Visual */
        .play-btn {
            width: 50px; height: 50px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.2);
            display: flex; align-items: center; justify-content: center; transition: all 0.3s;
        }
        .tilt-card:hover .play-btn { background: var(--c-sand); border-color: var(--c-sand); color: black; }

        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body>

    <div id="cursor"><span id="cursor-text"></span></div>
    <canvas id="global-canvas"></canvas>

    <!-- LOADER -->
    <div class="loader" id="loader">
        <div class="font-tech text-xl tracking-[0.3em] text-[#D4A056] mb-4">WAYUU</div>
        <div class="w-48 h-[1px] bg-white/10 rounded overflow-hidden">
            <div class="loader-line h-full" id="loader-bar"></div>
        </div>
    </div>
    
    <nav class="fixed top-8 left-8 right-8 z-50 flex justify-between items-center mix-blend-difference">
        <div class="text-xs font-tech tracking-[0.3em] text-white hover-trigger">NACIÓN WAYUU</div>
        <div class="w-10 h-10 border border-white/30 rounded-full flex items-center justify-center cursor-pointer hover-trigger hover:bg-white hover:text-black transition-all">
            <div class="w-4 h-[1px] bg-current"></div>
        </div>
    </nav>

    <!-- MAIN -->
    <main id="main-content" style="opacity: 0;">
        
        <!-- 1. HERO -->
        <section class="relative h-screen flex items-center justify-center overflow-hidden">
            <video autoplay muted loop playsinline class="hero-video-bg">
                <source src="../../video/wayuu_desierto_ss.mp4" type="video/mp4">
            </video>
            
            <div class="text-center relative z-10 flex flex-col items-center">
                <p class="font-tech text-xs tracking-[0.8em] text-white/60 mb-6 reveal-text">ORIGEN</p>
                <h1 class="giant-text font-display reveal-title">WA<span>YUU</span></h1>
                <p class="mt-8 text-sm md:text-lg text-white/80 font-light tracking-widest max-w-md reveal-text uppercase">
                    Hijos de la lluvia y la sequía
                </p>
            </div>
        </section>

        <!-- 2. IDENTIDAD -->
        <section class="min-h-screen py-32 px-6 md:px-24 relative flex items-center z-20">
            <div class="max-w-7xl mx-auto w-full grid grid-cols-1 md:grid-cols-2 gap-20 items-center">
                <div class="space-y-12">
                    <h2 class="text-5xl md:text-8xl font-display leading-none text-white">
                        Sangre de <br> <span class="text-[#C89F65] italic">Cactus</span>
                    </h2>
                    <p class="text-xl text-gray-400 font-light leading-relaxed max-w-md hover-trigger">
                        Un pueblo milenario que teje su historia en cada hilo. La aridez no es un vacío, es un lienzo.
                    </p>
                    <div class="border border-white/10 bg-white/5 p-6 inline-block rounded-xl backdrop-blur-md">
                        <span class="block text-4xl font-bold text-white mb-1">600k+</span>
                        <span class="text-xs tracking-widest text-gray-500 uppercase">Habitantes Binacionales</span>
                    </div>
                </div>
                
                <div class="relative h-[70vh] w-full">
                    <div class="absolute inset-0 bg-[#1a1a1a] overflow-hidden rounded-sm filter brightness-90">
                        <img src="../../img/Mujeres-wayuu.jpg" class="w-full h-full object-cover scale-110" id="parallax-img" alt="Mujer Wayuu">
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. ESFERA DE HILOS (3D INTERACTIVO) -->
        <section class="h-[80vh] w-full flex flex-col items-center justify-center relative bg-[#050200] overflow-hidden z-20">
            <div class="absolute top-10 w-full text-center z-20 pointer-events-none mix-blend-difference">
                <span class="text-[#FF3B3B] text-xs font-mono tracking-[0.4em] uppercase">Interacción</span>
                <h3 class="text-3xl font-display text-white mt-2">El Hilo de la Vida</h3>
            </div>
            <div id="weaving-container" class="w-full h-full cursor-grab active:cursor-grabbing"></div>
        </section>

        <!-- 4. AUDIO (WEB AUDIO API - SIN ERRORES) -->
        <section class="py-32 px-6 md:px-24 relative z-10">
            <div class="max-w-7xl mx-auto">
                <p class="text-[#C89F65] font-mono text-xs tracking-widest mb-4">02 — WAYUUNAIKI</p>
                <h2 class="text-4xl md:text-6xl font-display text-white mb-16">Voces del <span class="italic text-gray-500">Viento</span></h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Audio 1 -->
                    <div class="tilt-card p-12 rounded-2xl cursor-none audio-trigger group" onclick="playMysticalSound('low')">
                        <div class="tilt-inner flex justify-between items-start">
                            <div>
                                <h3 class="text-5xl font-display text-white group-hover:text-[#C89F65] transition-colors">Anasü</h3>
                                <p class="mt-4 text-gray-400 font-mono text-sm uppercase tracking-widest">/a-na-sü/ — "Está bien"</p>
                            </div>
                            <div class="play-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                            </div>
                        </div>
                    </div>

                    <!-- Audio 2 -->
                    <div class="tilt-card p-12 rounded-2xl cursor-none audio-trigger group" onclick="playMysticalSound('high')">
                        <div class="tilt-inner flex justify-between items-start">
                            <div>
                                <h3 class="text-5xl font-display text-white group-hover:text-[#00C4CC] transition-colors">Mma</h3>
                                <p class="mt-4 text-gray-400 font-mono text-sm uppercase tracking-widest">/m-ma/ — "Tierra Madre"</p>
                            </div>
                            <div class="play-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. LAPÜ (SUEÑOS) -->
        <section id="lapu-section" class="relative h-screen w-full bg-[#020202] overflow-hidden flex items-center justify-center cursor-none z-20">
            <div id="dream-canvas-container" class="absolute inset-0 z-0"></div>
            <div class="relative z-10 text-center pointer-events-none mix-blend-exclusion px-4">
                <span class="text-xs font-tech text-[#FF3B3B] tracking-[0.5em] block mb-2">03 — LAPÜ</span>
                <p class="text-white/40 text-xs font-mono mt-[40vh] animate-pulse">( Mueve para revelar )</p>
            </div>
        </section>

        <!-- 6. VIDEO -->
        <section class="relative h-screen flex items-center justify-center overflow-hidden bg-black video-cursor-area">
            <div class="absolute inset-0 z-10 bg-black/40"></div>
            <iframe class="absolute w-[150%] h-[150%] opacity-70 pointer-events-none" 
                style="top:50%; left:50%; transform:translate(-50%,-50%);"
                src="https://www.youtube.com/embed/S_Jc8jOWgqg?autoplay=1&mute=1&controls=0&loop=1&playlist=S_Jc8jOWgqg" 
                frameborder="0" allow="autoplay; encrypted-media"></iframe>
            <div class="relative z-20 text-center mix-blend-overlay">
                <h2 class="text-[12vw] font-display text-white leading-none tracking-tighter">RITUAL</h2>
                <p class="text-white text-xl font-light italic mt-4">La Yonna</p>
            </div>
        </section>

        <!-- 7. FINAL -->
        <section id="jepira-section" class="min-h-screen flex flex-col items-center justify-center relative">
            <div class="cosmos-bg" id="cosmos-overlay"></div>
            <div class="relative z-10 text-center px-6 max-w-3xl">
                <span class="text-[#A5D8FF] text-xs font-mono mb-6 block tracking-widest">05 — JEPIRA</span>
                <h2 class="text-5xl md:text-7xl font-display text-white mb-8">El Camino de las Almas</h2>
                <a href="#" class="inline-block px-10 py-4 border border-white/20 rounded-full text-xs font-bold uppercase tracking-widest text-white hover:bg-white hover:text-black transition-all hover-trigger">Reiniciar</a>
            </div>
        </section>

        <footer class="py-12 bg-black border-t border-white/10 text-center relative z-20">
            <p class="font-tech text-[10px] text-gray-600 tracking-[0.3em]">CULTURA WAYUU DIGITAL © 2025</p>
             <img src="../../img/Logo.png" alt="Logo Ululato" class="footer-logo mx-auto mt-4 w-24">
        </footer>
    </main>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.0/vanilla-tilt.min.js"></script>

    <script>
        // --- FUNCIÓN DE AUDIO GENERATIVO (Solución Definitiva) ---
        // Genera un sonido de "viento/campana" usando Web Audio API sin archivos externos
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playMysticalSound(tone) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            // Configuración
            osc.type = 'sine';
            // Frecuencias pentatónicas para sonar "místico"
            osc.frequency.setValueAtTime(tone === 'low' ? 196.00 : 329.63, audioCtx.currentTime); // G3 o E4
            
            // Envelope (Fade in - Fade out suave)
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.1); // Attack
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 3); // Release largo (eco)
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start();
            osc.stop(audioCtx.currentTime + 3);
        }

        document.addEventListener('DOMContentLoaded', () => {
            gsap.registerPlugin(ScrollTrigger);

            // --- LOADER ---
            const loader = document.getElementById('loader');
            const loaderBar = document.getElementById('loader-bar');
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 8;
                if(progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    const tl = gsap.timeline();
                    tl.to(loader, { opacity: 0, duration: 1, onComplete: () => loader.style.display = 'none' })
                      .to("#main-content", { opacity: 1, duration: 1.5 }, "-=0.5")
                      .to("#global-canvas", { opacity: 1, duration: 2 }, "-=1.5")
                      .from(".reveal-title", { y: 100, opacity: 0, duration: 1.5, ease: "power4.out" }, "-=1")
                      .from(".reveal-text", { y: 30, opacity: 0, duration: 1, stagger: 0.2 }, "-=1");
                }
                loaderBar.style.width = `${progress}%`;
            }, 50);

            // --- CURSOR ---
            const cursor = document.getElementById('cursor');
            const cursorText = document.getElementById('cursor-text');
            window.addEventListener('mousemove', (e) => {
                gsap.to(cursor, { x: e.clientX, y: e.clientY, duration: 0.1, ease: 'power2.out' });
            });

            // Handlers Cursor
            const addHover = (cls, txt = "") => {
                cursor.classList.add(cls);
                cursorText.innerText = txt;
            };
            const removeHover = (cls) => {
                cursor.classList.remove(cls);
                cursorText.innerText = "";
            };

            document.querySelectorAll('.hover-trigger').forEach(el => {
                el.addEventListener('mouseenter', () => addHover('hovered'));
                el.addEventListener('mouseleave', () => removeHover('hovered'));
            });

            document.getElementById('lapu-section')?.addEventListener('mouseenter', () => addHover('dream-mode'));
            document.getElementById('lapu-section')?.addEventListener('mouseleave', () => removeHover('dream-mode'));
            
            document.querySelector('.video-cursor-area')?.addEventListener('mouseenter', () => addHover('video-mode', 'VER'));
            document.querySelector('.video-cursor-area')?.addEventListener('mouseleave', () => removeHover('video-mode'));

            document.querySelectorAll('.audio-trigger').forEach(el => {
                el.addEventListener('mouseenter', () => addHover('audio-mode', 'OÍR'));
                el.addEventListener('mouseleave', () => removeHover('audio-mode'));
            });

            // --- TILT INIT (Solo si existen) ---
            const cards = document.querySelectorAll(".tilt-card");
            if(cards.length > 0 && typeof VanillaTilt !== 'undefined') {
                 VanillaTilt.init(cards, {
                    max: 15, speed: 400, glare: true, "max-glare": 0.2, scale: 1.05
                });
            }

            // --- THREE.JS GLOBAL ---
            const initGlobalThree = () => {
                const canvas = document.getElementById('global-canvas');
                if(!canvas) return;
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

                const count = 2500;
                const geometry = new THREE.BufferGeometry();
                const pos = new Float32Array(count*3);
                const original = new Float32Array(count*3);
                const colors = new Float32Array(count*3);
                const cSand = new THREE.Color('#C89F65');
                const cStar = new THREE.Color('#A5D8FF');

                for(let i=0; i<count*3; i+=3) {
                    pos[i] = (Math.random()-0.5)*35; pos[i+1] = (Math.random()-0.5)*40; pos[i+2] = (Math.random()-0.5)*20;
                    original[i] = pos[i]; original[i+1] = pos[i+1];
                    colors[i]=cSand.r; colors[i+1]=cSand.g; colors[i+2]=cSand.b;
                }
                geometry.setAttribute('position', new THREE.BufferAttribute(pos, 3));
                geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

                const material = new THREE.PointsMaterial({ size: 0.04, vertexColors: true, transparent: true, opacity: 0.8, blending: THREE.AdditiveBlending });
                const particles = new THREE.Points(geometry, material);
                scene.add(particles);
                camera.position.z = 5;

                const simplex = new SimplexNoise();
                const clock = new THREE.Clock();

                const animate = () => {
                    const t = clock.getElapsedTime();
                    particles.rotation.y = t * 0.02;
                    const p = geometry.attributes.position.array;
                    for(let i=0; i<count; i++) {
                        const i3 = i*3;
                        p[i3+1] = original[i3+1] + simplex.noise2D(original[i3]*0.1, t*0.2)*0.3;
                    }
                    geometry.attributes.position.needsUpdate = true;
                    renderer.render(scene, camera);
                    requestAnimationFrame(animate);
                };
                animate();

                ScrollTrigger.create({
                    trigger: "#jepira-section", start: "top center",
                    onEnter: () => {
                        gsap.to("#cosmos-overlay", {opacity: 1, duration: 2});
                        const c = geometry.attributes.color.array;
                        const obj = {t:0};
                        gsap.to(obj, {t:1, duration:2, onUpdate:()=>{
                            for(let i=0; i<count*3; i+=3) {
                                c[i] = THREE.MathUtils.lerp(cSand.r, cStar.r, obj.t);
                                c[i+1] = THREE.MathUtils.lerp(cSand.g, cStar.g, obj.t);
                                c[i+2] = THREE.MathUtils.lerp(cSand.b, cStar.b, obj.t);
                            }
                            geometry.attributes.color.needsUpdate = true;
                        }});
                    },
                    onLeaveBack: () => {
                         gsap.to("#cosmos-overlay", {opacity: 0, duration: 2});
                         const c = geometry.attributes.color.array;
                         const obj = {t:0};
                         gsap.to(obj, {t:1, duration:2, onUpdate:()=>{
                            for(let i=0; i<count*3; i+=3) {
                                c[i] = THREE.MathUtils.lerp(cStar.r, cSand.r, obj.t);
                                c[i+1] = THREE.MathUtils.lerp(cStar.g, cSand.g, obj.t);
                                c[i+2] = THREE.MathUtils.lerp(cStar.b, cSand.b, obj.t);
                            }
                            geometry.attributes.color.needsUpdate = true;
                         }});
                    }
                });
            };
            initGlobalThree();


            // --- THREE.JS WEAVING ---
            (function() {
                const container = document.getElementById('weaving-container');
                if(!container) return;
                const scene = new THREE.Scene();
                scene.fog = new THREE.FogExp2(0x050200, 0.002);
                const camera = new THREE.PerspectiveCamera(75, container.clientWidth/container.clientHeight, 0.1, 1000);
                camera.position.z = 15;
                const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                container.appendChild(renderer.domElement);

                const group = new THREE.Group();
                scene.add(group);
                const pCount = 300;
                const pData = [];
                const pGeo = new THREE.BufferGeometry();
                const pPos = new Float32Array(pCount*3);
                
                for(let i=0; i<pCount; i++) {
                    const theta = Math.random()*Math.PI*2;
                    const phi = Math.acos((Math.random()*2)-1);
                    const r = 6;
                    pPos[i*3] = r*Math.sin(phi)*Math.cos(theta);
                    pPos[i*3+1] = r*Math.sin(phi)*Math.sin(theta);
                    pPos[i*3+2] = r*Math.cos(phi);
                    pData.push({ vel: new THREE.Vector3(Math.random()-0.5, Math.random()-0.5, Math.random()-0.5).multiplyScalar(0.02), con:0 });
                }
                pGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3).setUsage(THREE.DynamicDrawUsage));
                const points = new THREE.Points(pGeo, new THREE.PointsMaterial({color: 0xFF3B3B, size: 0.1, transparent:true}));
                group.add(points);

                const lGeo = new THREE.BufferGeometry();
                const lPos = new Float32Array(pCount*pCount*3);
                const lCol = new Float32Array(pCount*pCount*3);
                lGeo.setAttribute('position', new THREE.BufferAttribute(lPos, 3).setUsage(THREE.DynamicDrawUsage));
                lGeo.setAttribute('color', new THREE.BufferAttribute(lCol, 3).setUsage(THREE.DynamicDrawUsage));
                const lines = new THREE.LineSegments(lGeo, new THREE.LineBasicMaterial({vertexColors: true, transparent:true, opacity:0.4}));
                group.add(lines);

                let mx=0, my=0;
                container.addEventListener('mousemove', e => {
                    const rect = container.getBoundingClientRect();
                    mx = ((e.clientX - rect.left)/rect.width)*2 - 1;
                    my = -((e.clientY - rect.top)/rect.height)*2 + 1;
                });

                const animate = () => {
                    group.rotation.x += 0.002 + my*0.01;
                    group.rotation.y += 0.002 + mx*0.01;
                    let vPos=0, cPos=0, con=0;
                    for(let i=0; i<pCount; i++) pData[i].con=0;

                    for(let i=0; i<pCount; i++) {
                        pPos[i*3] += pData[i].vel.x; pPos[i*3+1] += pData[i].vel.y; pPos[i*3+2] += pData[i].vel.z;
                        const d = Math.sqrt(pPos[i*3]**2 + pPos[i*3+1]**2 + pPos[i*3+2]**2);
                        if(d>7 || d<4) pData[i].vel.multiplyScalar(-1);

                        if(pData[i].con>=3) continue;
                        for(let j=i+1; j<pCount; j++) {
                            if(pData[j].con>=3) continue;
                            const dx = pPos[i*3]-pPos[j*3], dy = pPos[i*3+1]-pPos[j*3+1], dz = pPos[i*3+2]-pPos[j*3+2];
                            const dist = Math.sqrt(dx*dx+dy*dy+dz*dz);
                            if(dist<2.5) {
                                pData[i].con++; pData[j].con++;
                                lPos[vPos++]=pPos[i*3]; lPos[vPos++]=pPos[i*3+1]; lPos[vPos++]=pPos[i*3+2];
                                lPos[vPos++]=pPos[j*3]; lPos[vPos++]=pPos[j*3+1]; lPos[vPos++]=pPos[j*3+2];
                                lCol[cPos++]=1; lCol[cPos++]=0.2+(dist*0.2); lCol[cPos++]=0.2;
                                lCol[cPos++]=1; lCol[cPos++]=0.2+(dist*0.2); lCol[cPos++]=0.2;
                                con++;
                            }
                        }
                    }
                    lines.geometry.setDrawRange(0, con*2);
                    lines.geometry.attributes.position.needsUpdate = true;
                    lines.geometry.attributes.color.needsUpdate = true;
                    points.geometry.attributes.position.needsUpdate = true;
                    renderer.render(scene, camera);
                    requestAnimationFrame(animate);
                };
                animate();
            })();


            // --- THREE.JS SHADER (SUEÑOS) ---
            (function() {
                const container = document.getElementById('dream-canvas-container');
                if(!container) return;
                const scene = new THREE.Scene();
                const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);
                const renderer = new THREE.WebGLRenderer({ alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                container.appendChild(renderer.domElement);

                function createTextTexture() {
                    const cvs = document.createElement('canvas');
                    cvs.width = window.innerWidth; cvs.height = window.innerHeight;
                    const ctx = cvs.getContext('2d');
                    const cx = cvs.width/2, cy = cvs.height/2;
                    ctx.font = "italic 700 15vw 'Playfair Display'"; ctx.fillStyle = "white"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
                    ctx.fillText("SUEÑOS", cx, cy);
                    ctx.font = "300 1.5vw 'Manrope'"; ctx.fillStyle = "#C89F65";
                    ctx.fillText("Busca la luz en la oscuridad", cx, cy + (cvs.width * 0.12));
                    return new THREE.CanvasTexture(cvs);
                }

                const material = new THREE.ShaderMaterial({
                    uniforms: { uTime: {value:0}, uMouse: {value: new THREE.Vector2(0.5,0.5)}, uResolution: {value: new THREE.Vector2(window.innerWidth, window.innerHeight)}, uTexture: {value: createTextTexture()} },
                    vertexShader: `varying vec2 vUv; void main(){vUv=uv; gl_Position=vec4(position,1.0);}`,
                    fragmentShader: `
