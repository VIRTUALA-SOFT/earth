<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nación Wayuu | Inmersión Digital</title>
    
    <!-- FUENTES -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Syncopate:wght@400;700&family=Manrope:wght@200;300;400;500&display=swap" rel="stylesheet">
    
    <!-- LIBRERÍAS EXTERNAS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/gh/studio-freight/lenis@1.0.29/bundled/lenis.min.js"></script>
    
    <style>
        :root {
            --c-bg: #050200;
            --c-sand: #C89F65;
            --c-accent: #FF3B3B;
            --c-star: #A5D8FF;
        }

        body { 
            background-color: var(--c-bg); 
            color: #f3f3f3; 
            font-family: 'Manrope', sans-serif; 
            overflow-x: hidden; 
            cursor: none; 
            margin: 0;
        }

        .font-display { font-family: 'Playfair Display', serif; }
        .font-decor { font-family: 'Cinzel Decorative', serif; }
        .font-tech { font-family: 'Syncopate', sans-serif; }

        /* CURSOR */
     #cursor {
            position: fixed; top: 0; left: 0; width: 20px; height: 20px;
            background: #ffffff; 
            border-radius: 50%;
            pointer-events: none; 
            z-index: 99999; /* Máxima prioridad */
            transform: translate(-50%, -50%); 
            transition: width 0.3s cubic-bezier(0.19, 1, 0.22, 1), 
                        height 0.3s cubic-bezier(0.19, 1, 0.22, 1), 
                        background-color 0.2s;
            mix-blend-mode: difference; /* Inversión por defecto */
            display: flex; justify-content: center; align-items: center;
        }
        
        #cursor span { 
            opacity: 0; 
            font-size: 10px; font-weight: 800; color: white; 
            font-family: 'Syncopate', sans-serif; letter-spacing: 1px;
            pointer-events: none;
        }

        /* ESTADO: AUDIO (EL ROJO IMPORTANTE) */
        #cursor.audio-mode { 
            width: 90px !important; 
            height: 90px !important; 
            background: #FF3B3B !important; /* Rojo Forzado */
            border: none !important;
            mix-blend-mode: normal !important; /* APAGAMOS LA MEZCLA para que se vea rojo puro */            
            opacity: 1 !important;
            box-shadow: 0 4 30px rgba(255, 59, 59, 0.5) !important;            
        }
        
       #cursor.audio-mode span {         
        opacity: 1 !important; 
        color: white !important;
        font-weight: 800;
        font-size: 12px;
      }
        
   /* ESTADO: HOVER SIMPLE */
        #cursor.hovered { width: 50px; height: 50px; background: white; mix-blend-mode: difference; }

        /* ESTADO: SUEÑOS */
        #cursor.dream-mode { width: 150px; height: 150px; background: rgba(255,255,255,0.1); backdrop-filter: blur(5px); mix-blend-mode: normal; }


      /* ESTADO: VIDEO */
        #cursor.video-mode { 
            width: 100px; 
            height: 100px; 
            background: white; 
            mix-blend-mode: difference; 
        }
        #cursor.video-mode span { 
            opacity: 1; 
            color: black; /* Texto negro sobre fondo blanco */
        }
     

        /* UTILIDADES VISUALES */
        #global-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; opacity: 0; }
        
        .giant-text {
            font-size: clamp(4rem, 15vw, 20rem); line-height: 0.8; color: transparent;
            -webkit-text-stroke: 1px rgba(255,255,255,0.3); mix-blend-mode: overlay;
        }
        .giant-text span { color: var(--c-sand); -webkit-text-stroke: 0; }

        .hero-video-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover;
            opacity: 0.5; filter: contrast(1.1) brightness(0.8);
            mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
        }

        /* TILT CARDS */
     /*   .tilt-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform-style: preserve-3d;
            transform: perspective(1000px);
            transition: all 0.3s ease;
        }*/
       /* .tilt-card:hover { border-color: var(--c-sand); background: rgba(255, 255, 255, 0.1); }*/
        .tilt-inner { transform: translateZ(20px); }        
        
        /* LOADER */
        .loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--c-bg); z-index: 10000;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .loader-line {
            width: 0%; height: 2px; background: linear-gradient(90deg, var(--c-accent), var(--c-sand)); transition: width 0.2s linear;
        }
        
        /* Estado inicial del contenido principal */
        #main-content {
            opacity: 0;
            transition: opacity 1.5s ease;
        }

        .cosmos-bg {
            position: absolute; inset: 0; background: radial-gradient(circle at center, #0B1026 0%, #000000 100%);
            opacity: 0; transition: opacity 1.5s ease; pointer-events: none;
        }
        
         /* PLAY BUTTON */
        .play-btn {
            width: 48px; height: 48px; border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.3);
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s;
        }
        .tilt-card:hover .play-btn { background: var(--c-sand); border-color: var(--c-sand); color: black; transform: scale(1.1); }

        ::-webkit-scrollbar { width: 0px; }

        /* --- ECUALIZADOR ANIMADO --- */
        @keyframes equalize {
            0% { height: 3px; }
            50% { height: 100%; }
            100% { height: 3px; }
        }
        
        .bar {
            width: 3px;
            background-color: currentColor; /* Hereda el color del texto */
            border-radius: 9999px;
            animation: equalize 1s infinite ease-in-out;
        }
        
        /* Retrasos para que parezca aleatorio */
        .bar:nth-child(1) { animation-delay: -0.4s; height: 60%; }
        .bar:nth-child(2) { animation-delay: -0.2s; height: 100%; }
        .bar:nth-child(3) { animation-delay: -0.6s; height: 40%; }
        .bar:nth-child(4) { animation-delay: -0.8s; height: 80%; }
        
        /* Estado Pausado (opcional, si quieres que se detengan al pausar) */
        .paused .bar { animation-play-state: paused; height: 3px !important; transition: height 0.3s; }

        /* --- FONDO CINEMÁTICO --- */
        .desert-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
            z-index: 0;
            /* Efecto de Zoom lento constante para dar vida */
            animation: slowZoom 60s infinite alternate;
        }
        
        @keyframes slowZoom {
            from { transform: scale(1); }
            to { transform: scale(1.15); }
        }
        
        /* Capa oscura para garantizar lectura */
        .desert-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, rgba(0,0,0,0.6) 0%, #050200 100%);
            z-index: 1;
            pointer-events: none;
        }
        
                /* --- TARJETAS CRISTAL (MIRAGE EFFECT) --- */
        .tilt-card {
            /* Fondo semi-transparente oscuro */
            background: rgba(0, 0, 0, 0.4); 
            /* Desenfoque fuerte para suavizar el fondo */
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s ease;
            z-index: 10; /* Encima del fondo */
        }
        
        /* AL HACER HOVER O REPRODUCIR */
        .tilt-card:hover, .tilt-card.playing {
            /* Se vuelve más transparente para ver el desierto detrás */
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(5px); /* Menos desenfoque = Más nitidez del fondo */
            border-color: var(--c-sand);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        }
        
        /* Texto Wayuunaiki más brillante para contrastar */
        .tilt-card h3 { text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

        /* --- DEGRADADO DE BORDES (CINEMATIC FADE) --- */
        .cinematic-fade {
            position: absolute;
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            pointer-events: none; /* Permite dar clic a través de ella */
            z-index: 2; /* Se coloca encima de la imagen y del overlay oscuro */
            background: linear-gradient(
                to bottom,
                #050200 0%,        /* Negro arriba */
                transparent 20%,   /* Se vuelve transparente al bajar */
                transparent 80%,   /* Se mantiene transparente */
                #050200 100%       /* Vuelve a negro abajo */
            );
        }

         /* HORIZONTAL SCROLL (IDENTITY) */
        .horizontal-container {
            width: 400%; /* 4 Paneles */
            height: 100vh;
            display: flex;
            flex-wrap: nowrap;
        }
        .panel {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 4rem;
            border-right: 1px solid rgba(255,255,255,0.05);
        }
        .panel-bg {
            position: absolute; inset: 0; z-index: 0;
            filter: brightness(0.4) grayscale(0.5);
            transition: transform 0.5s;
        }
        .panel:hover .panel-bg { transform: scale(1.02); filter: brightness(0.5) grayscale(0.2); }

         /* JEPIRA (COSMOS) */
        .warp-speed-effect {
            position: absolute; inset: 0;
            background: radial-gradient(circle at center, transparent 0%, #000 90%);
            z-index: 1;
        }

        /* --- MEJORA DE VIDEO (MÁS LUZ Y COLOR) --- */
.cinematic-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0.9; /* Subimos de 0.6 a 0.9 (Mucho más visible) */
    filter: contrast(1.1) saturate(1.2); /* Realza los colores del desierto */
    transition: opacity 0.5s ease;
}

        /* --- CONTINUIDAD (BORDES FUNDIDOS) --- */
/* Esto crea el degradado negro arriba y abajo para que no se note el corte */
.panel-fade {
    position: absolute;
    inset: 0;
    pointer-events: none; /* Permite dar clic a través */
    z-index: 2;
    background: linear-gradient(
        to bottom,
        #050200 0%,         /* Negro arriba (fusión con sección anterior) */
        transparent 15%,    /* Transparente rápido para ver el video */
        transparent 85%,    /* Se mantiene transparente */
        #050200 100%        /* Negro abajo (fusión con footer/siguiente) */
    );
}

/* --- SOMBRA SOLO DETRÁS DEL TEXTO --- */
/* En lugar de oscurecer todo el video, oscurecemos solo donde va el texto */
.text-protection {
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at center, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.6) 100%);
    z-index: 1;
}
        

    </style>
</head>
<body>

    <div id="cursor"><span id="cursor-text"></span></div>
    <canvas id="global-canvas"></canvas>

    <!-- LOADER -->
    <div class="loader" id="loader">
        <div class="font-tech text-xl tracking-[0.3em] text-[#D4A056] mb-4">WAYUU</div>
        <div class="w-48 h-[1px] bg-white/10 rounded overflow-hidden">
            <div class="loader-line h-full" id="loader-bar"></div>
        </div>
    </div>
    
    <nav class="fixed top-8 left-8 right-8 z-50 flex justify-between items-center mix-blend-difference">
        <div class="text-xs font-tech tracking-[0.3em] text-white hover-trigger">NACIÓN WAYUU</div>
        <div class="w-10 h-10 border border-white/30 rounded-full flex items-center justify-center cursor-pointer hover-trigger hover:bg-white hover:text-black transition-all">
            <div class="w-4 h-[1px] bg-current"></div>
        </div>
    </nav>

    <!-- MAIN -->
    <main id="main-content">
        
        <!-- 1. HERO -->
        <section class="relative h-screen flex items-center justify-center overflow-hidden">
            <video autoplay muted loop playsinline class="hero-video-bg">
                <source src="../../video/wayuu_desierto_ss.mp4" type="video/mp4">
            </video>
            
            <div class="text-center relative z-10 flex flex-col items-center">
                <p class="font-tech text-xs tracking-[0.8em] text-white/60 mb-6 reveal-text">ORIGEN</p>
                <h1 class="giant-text font-display reveal-title">WA<span>YUU</span></h1>
                <p class="mt-8 text-sm md:text-lg text-white/80 font-light tracking-widest max-w-md reveal-text uppercase">
                    Hijos de la lluvia y la sequía
                </p>
                 <p class="mt-8 text-sm md:text-lg text-white/80 font-light tracking-widest max-w-md reveal-text uppercase">
                    EL CAMINO DE LAS ALMAS
                </p>
            </div>

              <!-- FLECHA SCROLL -->
            <div class="absolute bottom-10 animate-bounce z-20 text-white/50">
                <p class="text-[9px] tracking-[0.3em] mb-2 uppercase">Descubre su historia</p>
                <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
            </div>
            
        </section>

        <!-- 2. IDENTIDAD (VIDEOS VIVOS + BORDES FUNDIDOS) -->
<section id="identity-section" class="overflow-hidden h-screen bg-[#050200] relative z-20">
    <div class="horizontal-container" id="horizontal-wrapper">
        
        <!-- Intro Panel -->
        <div class="panel bg-black relative">
            <div class="z-10 max-w-2xl px-6">
                <span class="text-[#FF3B3B] font-mono text-xs tracking-widest mb-4 block">01 — IDENTIDAD</span>
                <h2 class="text-5xl md:text-8xl font-display text-white mb-8">Los 4 Pilares <br><span class="italic text-[#C89F65]">Ancestrales</span></h2>
                <p class="text-gray-400 text-lg font-light">
                    Más que una etnia, somos una civilización del desierto.
                    <br><br>
                    <span class="text-xs font-mono border-b border-gray-600 pb-1 animate-pulse">DESLIZA ▶</span>
                </p>
            </div>
            <!-- Degradado de continuidad también aquí -->
            <div class="panel-fade"></div>
        </div>

        <!-- Panel 1: Social -->
        <div class="panel hover-trigger group relative">
            <!-- VIDEO MEJORADO -->
            <div class="absolute inset-0 w-full h-full">
                <video autoplay muted loop playsinline class="cinematic-video">
                     <source src="../../video/wayuu-rojas2.mp4" type="video/mp4">
                </video>
                <!-- Protección visual suave -->
                <div class="text-protection"></div>
                <!-- BORDES FUNDIDOS (Tu requerimiento) -->
                <div class="panel-fade"></div>
            </div>

            <div class="glass-card p-10 max-w-xl z-20 relative backdrop-blur-md border border-white/10">
                <h3 class="text-4xl font-display text-white mb-4">La Sangre Materna</h3>
                <p class="text-gray-200 font-light mb-4 text-lg">
                    Sociedad <strong class="text-[#C89F65]">Matrilineal</strong>. El apellido y el clan (*Eiruku*) se heredan de la madre. Ella es la raíz.
                </p>
                <ul class="text-xs font-mono text-gray-300 space-y-2 border-t border-white/20 pt-4">
                    <li>• Eiruku: Carne / Clan</li>
                    <li>• 30+ Clanes (Uriana, Epieyu...)</li>
                </ul>
            </div>
        </div>

        <!-- Panel 2: Político -->
        <div class="panel hover-trigger group relative">
            <div class="absolute inset-0 w-full h-full">
                <video autoplay muted loop playsinline class="cinematic-video">
                    <source src="../../video/wayuu_video.mp4" type="video/mp4">
                </video>
                <div class="text-protection"></div>
                <div class="panel-fade"></div>
            </div>

            <div class="glass-card p-10 max-w-xl z-20 relative backdrop-blur-md border border-white/10">
                <h3 class="text-4xl font-display text-white mb-4">La Palabra es Ley</h3>
                <p class="text-gray-200 font-light mb-4 text-lg">
                    El <strong class="text-[#C89F65]">Pütchipü'ü</strong> (Palabrero) resuelve conflictos con el poder de la palabra, evitando la guerra y restaurando la armonía.
                </p>
                <span class="text-xs uppercase tracking-widest text-[#C89F65]">Patrimonio de la Humanidad</span>
            </div>
        </div>

        <!-- Panel 3: Económico -->
        <div class="panel hover-trigger group relative">
            <div class="absolute inset-0 w-full h-full">
                <video autoplay muted loop playsinline class="cinematic-video">
                    <source src="../../video/default_video.mp4" type="video/mp4">
                </video>
                <div class="text-protection"></div>
                <div class="panel-fade"></div>
            </div>

            <div class="glass-card p-10 max-w-xl z-20 relative backdrop-blur-md border border-white/10">
                <h3 class="text-4xl font-display text-white mb-4">Sustento y Arte</h3>
                <p class="text-gray-200 font-light mb-4 text-lg">
                    Pastoreo, pesca y tejido. Cada mochila (*Susu*) cuenta una historia geométrica (*Kanas*) que refleja el universo Wayuu.
                </p>
                <span class="text-[#C89F65] text-4xl font-bold block mt-4">Kanas <span class="text-sm font-normal text-white">Geometría Sagrada</span></span>
            </div>
        </div>

    </div>
</section>        
    

        <!-- 3. SECCIÓN: EL HILO DE LA VIDA (3D + STORYTELLING) -->
        <section class="h-screen w-full flex flex-col md:flex-row items-center justify-center relative bg-[#050200] overflow-hidden z-20">
            
            <!-- Lado Izquierdo: Narrativa -->
            <div class="absolute md:relative z-30 w-full md:w-1/3 px-8 md:pl-24 text-center md:text-left pointer-events-none mix-blend-difference">
                <span class="text-[#FF3B3B] text-xs font-mono tracking-[0.4em] uppercase mb-4 block">Wale'kerü</span>
                <h3 class="text-4xl md:text-6xl font-display text-white mb-6">El Tejido es <br><span class="italic text-[#C89F65]">Pensamiento</span></h3>
                <p class="text-sm text-gray-300 font-light leading-relaxed max-w-md mx-auto md:mx-0">
                    "La araña nos enseñó que tejer no es solo cruzar hilos. Es organizar la vida. 
                    Cada nudo es una familia, cada línea un camino. Al mover la red, sientes la tensión de todo un pueblo 
                    que se niega a romperse."
                </p>
                <div class="mt-8 flex items-center justify-center md:justify-start gap-4 opacity-70">
                    <div class="w-12 h-12 rounded-full border border-white/30 flex items-center justify-center animate-spin-slow">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white"><path d="M12 22C17.5 22 22 17.5 22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22Z" stroke-width="1.5"/><path d="M12 8V16" stroke-width="1.5"/><path d="M8 12H16" stroke-width="1.5"/></svg>
                    </div>
                    <span class="text-[10px] tracking-widest uppercase">Interactúa con la red</span>
                </div>
            </div>
        
            <!-- Lado Derecho: Interacción 3D -->
            <div id="weaving-container" class="absolute inset-0 md:relative md:w-2/3 h-full cursor-grab active:cursor-grabbing z-20 opacity-60 md:opacity-100"></div>
            
         </section>

      
        
      <!-- SECCIÓN: VOCES DEL VIENTO (CON FONDO CINEMÁTICO) -->
            <section class="py-32 px-6 md:px-12 relative overflow-hidden h-auto min-h-screen flex flex-col justify-center">
                
                <!-- 1. IMAGEN DE FONDO VIVA (Desierto Wayuu) -->
                <img src="../../img/wayuu_desierto.jpeg" 
                     alt="Desierto de la Guajira" 
                     class="desert-bg">
                     
                <!-- 2. OVERLAY OSCURO (Para que se lean los textos) -->
                <div class="desert-overlay"></div>

                <div class="cinematic-fade"></div>
                
                <!-- 3. CONTENIDO (Z-Index alto para estar sobre la imagen) -->
                <div class="max-w-[1400px] mx-auto w-full relative z-10">
                    
                    <div class="mb-16 border-l-2 border-[#C89F65] pl-6">
                                 <p class="text-[#C89F65] font-mono text-xs tracking-widest mb-2 shadow-black drop-shadow-md">02 — WAYUUNAIKI</p>
                        <h2 class="text-4xl md:text-6xl font-display text-white drop-shadow-lg">
                            El Idioma del <span class="italic text-[#C89F65]">Desierto</span>
                        </h2>
                    </div>
            
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                   <!-- TARJETA 1: Achonnii -->
                            <div id="card-audio1" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio1')">
                                <div class="relative z-10">
                                    <div class="flex justify-between items-start mb-12 h-8">
                                        <div class="flex items-end gap-2 h-full">
                                            <span class="text-xs font-mono text-gray-300 mb-1">01</span>
                                            <div id="eq-audio1" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300">
                                                <div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div>
                                            </div>
                                        </div>
                                        <div id="btn-audio1" class="play-btn text-white border-white/40">
                                            <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                        </div>
                                    </div>
                                    <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Achonnii</h3>
                                    <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/a-cho-nii/ — "Hijo"</p>
                                </div>
                                <audio id="audio1" src="../../vocabulario/wayuu/achonnii.mp3"></audio>
                            </div>
                
                                    <!-- TARJETA 2 -->
                            <div id="card-audio2" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio2')">
                                <div class="relative z-10">
                                    <div class="flex justify-between items-start mb-12 h-8">
                                        <div class="flex items-end gap-2 h-full">
                                            <span class="text-xs font-mono text-gray-300 mb-1">02</span>
                                            <div id="eq-audio2" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300">
                                                <div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div>
                                            </div>
                                        </div>
                                        <div id="btn-audio2" class="play-btn text-white border-white/40">
                                            <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                        </div>
                                    </div>
                                    <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Eyüü</h3>
                                    <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/e-yüü/ — "Madre"</p>
                                </div>
                                <audio  id="audio2" src="../../vocabulario/wayuu/eyuu.mp3"></audio>
                            </div>
                
                            <!-- TARJETA 3 -->
                    <div id="card-audio3" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio3')">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-12 h-8">
                                <div class="flex items-end gap-2 h-full">
                                    <span class="text-xs font-mono text-gray-300 mb-1">03</span>
                                    <div id="eq-audio3" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300">
                                        <div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div>
                                    </div>
                                </div>
                                <div id="btn-audio3" class="play-btn text-white border-white/40">
                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                </div>
                            </div>
                            <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Aa, anayawatsi</h3>
                                     <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/Aa-a-na-ya-wat-si/ — "Sí, gracias"</p>
                                </div>
                                <audio id="audio3" src="../../vocabulario/wayuu/aaanayaguatsi.mp3"></audio>
                            </div>
                
                             <!-- TARJETA 4 -->
                    <div id="card-audio4" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio4')">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-12 h-8">
                                <div class="flex items-end gap-2 h-full">
                                    <span class="text-xs font-mono text-gray-300 mb-1">04</span>
                                    <div id="eq-audio4" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300">
                                        <div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div>
                                    </div>
                                </div>
                                <div id="btn-audio4" class="play-btn text-white border-white/40">
                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                </div>
                            </div>
                            <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Anayawatsi ma'in</h3>
                                    <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/A-na-ya-wat-si-main/ — "Muchas gracias"</p>
                                </div>
                                <audio id="audio4" src="../../vocabulario/wayuu/anayaquatsi.mp3"></audio>
                            </div>
                
                            <!-- TARJETA 5 -->
                     <div id="card-audio5" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio5')">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-12 h-8">
                                <div class="flex items-end gap-2 h-full">
                                    <span class="text-xs font-mono text-gray-300 mb-1">05</span>
                                    <div id="eq-audio5" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300">
                                        <div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div>
                                    </div>
                                </div>
                                <div id="btn-audio5" class="play-btn text-white border-white/40">
                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                </div>
                            </div>
                            <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Wattama'at</h3>
                                    <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/Wa-tta-ma-at/ — "Es de mañana(Saludo estándar)"</p>
                                </div>
                                <audio id="audio5" src="../../vocabulario/wayuu/guattamaat.mp3"></audio>
                            </div>
                
                            <!-- TARJETA 6 -->
                     <div id="card-audio6" class="tilt-card p-10 rounded-xl cursor-none group relative overflow-hidden" onclick="playRealAudio('audio6')">
                        <div class="relative z-10">
                            <div class="flex justify-between items-start mb-12 h-8">
                                <div class="flex items-end gap-2 h-full">
                                    <span class="text-xs font-mono text-gray-300 mb-1">06</span>
                                    <div id="eq-audio6" class="flex gap-1 h-6 items-end opacity-0 transition-opacity duration-300">
                                        <div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div><div class="bar bg-[#C89F65]"></div>
                                    </div>
                                </div>
                                <div id="btn-audio6" class="play-btn text-white border-white/40">
                                    <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                </div>
                            </div>
                            <h3 class="text-4xl font-display text-white group-hover:text-[#C89F65] transition-colors">Paliijü taya</h3>
                                    <p class="mt-2 text-gray-200 font-mono text-[10px] uppercase tracking-widest">/Pa-lii-jü-ta-ya/ — "Por favor"</p>
                                </div>
                                <audio id="audio6" src="../../vocabulario/wayuu/paliijiu.mp3"></audio>
                            </div>
                
                        </div>
                    </div>
                </section>

       <!-- SECCIÓN: LAPÜ (ORÁCULO) -->
        <section id="lapu-section" class="relative h-screen w-full bg-[#020202] overflow-hidden flex items-center justify-center cursor-none z-20">
            <div id="dream-canvas-container" class="absolute inset-0 z-0"></div>
            <div class="relative z-10 text-center pointer-events-none mix-blend-exclusion px-4">
                <span class="text-xs font-tech text-[#FF3B3B] tracking-[0.5em] block mb-4">03 — LAPÜ (EL ORÁCULO)</span>
                
                <!-- Nuevo mensaje significativo -->
                <h2 class="text-3xl md:text-5xl font-display text-white mb-6">El Sueño es la <br>verdadera vigilia</h2>
                
                <div class="inline-flex flex-col items-center gap-2 mt-[30vh] opacity-60 animate-pulse">
                    <div class="w-[1px] h-12 bg-white"></div>
                    <p class="text-white text-[10px] font-mono tracking-widest uppercase">Disipa la niebla para recibir el mensaje</p>
                </div>
            </div>
        </section>

     <!-- 6. VIDEO (RITUAL) - CON BORDES FUNDIDOS -->
<section class="relative h-screen flex items-center justify-center overflow-hidden bg-[#050200] video-cursor-area">
    
    <!-- 1. CAPA DE VIDEO (FONDO) -->
    <div class="absolute inset-0 z-0">
            <!--<iframe class="absolute w-[150%] h-[150%] opacity-70 pointer-events-none" 
                style="top:50%; left:50%; transform:translate(-50%,-50%);"
                src="https://www.youtube.com/embed/yJMXzvZEZlQ?si=EVoSeu4BpinhA-iF&autoplay=1&mute=1&controls=0&loop=1&playlist=yJMXzvZEZlQ?si=EVoSeu4BpinhA-iF&start=0&end=42" 
                frameborder="0" allow="autoplay; encrypted-media">
               </iframe>-->
            <iframe
                <iframe class="w-full h-full object-cover opacity-60 pointer-events-none scale-125"                  
                 src="https://www.youtube.com/embed/yJMXzvZEZlQ?si=EVoSeu4BpinhA-iF&amp;controls=0&amp;&amp;loop=1&amp;autoplay=1&amp;mute=1&amp;start=0" title="YouTube video player" frameborder="0"  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>                
            </iframe>
    </div>
            <!-- Z-Index 10 para estar ENCIMA del video pero DEBAJO del texto -->
    <div class="cinematic-fade" style="z-index: 10;"></div>

    <!-- 3. CONTENIDO / TEXTO -->
    <div class="relative z-20 text-center mix-blend-overlay px-4">
        <h2 class="text-[15vw] md:text-[12vw] font-display text-white leading-none tracking-tighter select-none">
            RITUAL
        </h2>
        <p class="text-white/80 text-xl font-light italic mt-4 font-display tracking-widest">
            La Yonna
        </p>
    </div>

</section>   

        
     <!-- 7. JEPIRA (EL COSMOS - IMPACTO VISUAL) -->
<section id="jepira-section" class="h-screen relative flex items-center justify-center overflow-hidden">
    
    <!-- FONDO CÓSMICO (ID necesario para la animación JS) -->
    <div id="cosmos-overlay" class="cosmos-bg"></div>
    
    <!-- CONTENIDO -->
    <div class="relative z-20 text-center px-6">
        <span class="text-[#A5D8FF] text-xs font-mono mb-6 block tracking-[0.5em] uppercase">05 — Jepira</span>
        
        <h2 class="text-5xl md:text-8xl font-display text-white mb-8 mix-blend-screen">
            El Retorno a <br> las Estrellas
        </h2>
        
        <p class="text-gray-300 text-lg font-light leading-relaxed mb-12 max-w-lg mx-auto">
            La muerte no existe. Es solo convertirse en lluvia para volver a la tierra, o en luz para habitar la Vía Láctea (*Spieyu*).
        </p>
        
        <!-- Botón Reiniciar -->
        <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="px-10 py-4 border border-white/30 rounded-full text-xs font-bold uppercase tracking-widest text-white hover:bg-white hover:text-black transition-all hover-trigger bg-black/20 backdrop-blur-md">
            Regresar a la Tierra
        </button>
    </div>
</section>
        
       <!--
        <footer class="py-12 bg-black border-t border-white/10 text-center relative z-20">
            <p class="font-tech text-[10px] text-gray-600 tracking-[0.3em]">CULTURA WAYUU DIGITAL © 2025</p>
             <img src="../../img/Logo.png" alt="Logo Ululato" class="footer-logo mx-auto mt-4 w-24">
        </footer>-->

        <!-- FOOTER PREMIUM -->
        <footer class="bg-[#050200] pt-24 pb-12 px-6 border-t border-white/5 relative z-20">
            <div class="max-w-7xl mx-auto">
                
                <!-- Parte Superior: Grid -->
                <div class="grid grid-cols-1 md:grid-cols-12 gap-12 mb-20">
                    
                    <!-- Marca y Logo -->
                    <div class="md:col-span-5 flex flex-col justify-between h-full">
                        <div>
                            <img src="../../img/Logo.png" alt="Logo Ululato" class="w-32 mb-8 opacity-90 hover:opacity-100 transition-opacity">
                            <h2 class="text-4xl md:text-5xl font-display text-white leading-tight">
                                Preservando la <br> <span class="text-[#C89F65] italic">memoria ancestral</span> <br> en el código digital.
                            </h2>
                        </div>
                    </div>
        
                    <!-- Navegación -->
                    <div class="md:col-span-3 md:col-start-7">
                        <span class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-6 block">Explorar</span>
                        <ul class="space-y-4">
                            <li><a href="#" class="text-gray-300 hover:text-[#C89F65] transition-colors text-sm uppercase tracking-wider font-light">Origen</a></li>
                            <li><a href="#" class="text-gray-300 hover:text-[#C89F65] transition-colors text-sm uppercase tracking-wider font-light">Territorio</a></li>
                            <li><a href="#" class="text-gray-300 hover:text-[#C89F65] transition-colors text-sm uppercase tracking-wider font-light">Wayuunaiki</a></li>
                            <li><a href="#" class="text-gray-300 hover:text-[#C89F65] transition-colors text-sm uppercase tracking-wider font-light">Artesanía</a></li>
                        </ul>
                    </div>
        
                    <!-- Social -->
                    <div class="md:col-span-3">
                        <span class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-6 block">Conectar</span>
                        <ul class="space-y-4">
                            <li><a href="#" class="group flex items-center gap-2 text-gray-300 hover:text-white transition-colors">
                                <span class="text-sm">Instagram</span>
                                <svg class="w-3 h-3 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17 8l4 4m0 0l-4 4m4-4H3" stroke-width="2"/></svg>
                            </a></li>
                            <li><a href="#" class="group flex items-center gap-2 text-gray-300 hover:text-white transition-colors">
                                <span class="text-sm">Twitter / X</span>
                                <svg class="w-3 h-3 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17 8l4 4m0 0l-4 4m4-4H3" stroke-width="2"/></svg>
                            </a></li>
                            <li><a href="#" class="group flex items-center gap-2 text-gray-300 hover:text-white transition-colors">
                                <span class="text-sm">Email</span>
                                <svg class="w-3 h-3 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17 8l4 4m0 0l-4 4m4-4H3" stroke-width="2"/></svg>
                            </a></li>
                        </ul>
                    </div>
                </div>
        
                <!-- Parte Inferior: Copyright -->
                <div class="border-t border-white/10 pt-8 flex flex-col md:flex-row justify-between items-center gap-4">
                    <p class="font-tech text-[10px] text-gray-600 tracking-[0.2em]">© 2025 ULULATO STUDIO</p>
                    <div class="flex gap-6">
                        <a href="#" class="text-[10px] text-gray-600 hover:text-gray-400 uppercase tracking-widest">Privacidad</a>
                        <a href="#" class="text-[10px] text-gray-600 hover:text-gray-400 uppercase tracking-widest">Créditos</a>
                    </div>
                </div>
            </div>
        </footer>
        
    </main>

    <!-- SCRIPTS DE DEPENDENCIAS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.0/vanilla-tilt.min.js"></script>

  <script>
    // --- 1. FUNCIONES GLOBALES ---
    gsap.registerPlugin(ScrollTrigger);

    // Sistema de Audio
    function playRealAudio(id) {
        const allAudios = document.querySelectorAll('audio');
        const targetAudio = document.getElementById(id);
        const targetBtn = document.getElementById(`btn-${id}`);
        const targetEq = document.getElementById(`eq-${id}`);
        const targetCard = document.getElementById(`card-${id}`); 
        
        const playIcon = '<svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
        const pauseIcon = '<svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
    
        if (!targetAudio) return;
    
        if (!targetAudio.paused) {
            targetAudio.pause();
            if(targetBtn) targetBtn.innerHTML = playIcon;
            if(targetEq) { targetEq.classList.remove('opacity-100'); targetEq.classList.add('opacity-0'); }
            if(targetCard) targetCard.classList.remove('playing');
            return;
        }
    
        allAudios.forEach(audio => {
            audio.pause();
            audio.currentTime = 0;
            const btn = document.getElementById(`btn-${audio.id}`);
            const eq = document.getElementById(`eq-${audio.id}`);
            const card = document.getElementById(`card-${audio.id}`);
            
            if(btn) btn.innerHTML = playIcon;
            if(eq) { eq.classList.remove('opacity-100'); eq.classList.add('opacity-0'); }
            if(card) card.classList.remove('playing');
        });
    
        targetAudio.volume = 0.6;
        targetAudio.play().then(() => {
            if(targetBtn) targetBtn.innerHTML = pauseIcon;
            if(targetEq) { targetEq.classList.remove('opacity-0'); targetEq.classList.add('opacity-100'); }
            if(targetCard) targetCard.classList.add('playing');
        }).catch(e => console.log("Interacción requerida"));
    
        targetAudio.onended = () => {
            if(targetBtn) targetBtn.innerHTML = playIcon;
            if(targetEq) { targetEq.classList.remove('opacity-100'); targetEq.classList.add('opacity-0'); }
            if(targetCard) targetCard.classList.remove('playing');
        };
    }

    // Sistema de Carga
    function revealSite() {
        const loader = document.getElementById('loader');
        const main = document.getElementById('main-content');
        const canvas = document.getElementById('global-canvas');
        if (loader.style.opacity === '0') return; 
        try {
            if (typeof gsap !== 'undefined') {
                const tl = gsap.timeline();
                tl.to(loader, { opacity: 0, duration: 1, onComplete: () => { loader.style.display = 'none'; } })
                  .to(main, { opacity: 1, duration: 1.5 }, "-=0.5")
                  .to(canvas, { opacity: 1, duration: 2 }, "-=1.5")
                  .from(".reveal-title", { y: 100, opacity: 0, duration: 1.5, ease: "power4.out" }, "-=1")
                  .from(".reveal-text", { y: 30, opacity: 0, duration: 1, stagger: 0.2 }, "-=1");
            } else { throw new Error("GSAP no cargó"); }
        } catch (e) {
            loader.style.opacity = 0;
            setTimeout(() => { loader.style.display = 'none'; }, 500);
            main.style.opacity = 1;
            canvas.style.opacity = 1;
        }
    }

    // --- 2. INICIALIZACIÓN ---
    document.addEventListener('DOMContentLoaded', () => {
        
        // A. LOADER
        const loaderBar = document.getElementById('loader-bar');
        let progress = 0;
        const interval = setInterval(() => {
            progress += Math.random() * 8;
            if(loaderBar) loaderBar.style.width = `${progress}%`;
            if(progress >= 100) { clearInterval(interval); revealSite(); }
        }, 50);
        setTimeout(() => { if (progress < 100) { clearInterval(interval); revealSite(); } }, 4000);

        // B. CURSOR Y LÓGICA DE TARJETAS
         const cursor = document.getElementById('cursor');
        const cursorText = document.getElementById('cursor-text');

        window.addEventListener('mousemove', (e) => {
            gsap.to(cursor, { x: e.clientX, y: e.clientY, duration: 0.1, ease: 'power2.out' });
        });

        // Función Limpia Estados
        const resetCursor = () => {
            cursor.className = '';
            cursorText.innerText = "";
        };

        // LISTENER DE TARJETAS (Arreglado para el ROJO)
        const cards = document.querySelectorAll('.tilt-card');
        cards.forEach(card => {
            card.addEventListener('mouseenter', () => {
                resetCursor();
                cursor.classList.add('audio-mode');
                cursorText.innerText = "OÍR";
            });
            card.addEventListener('mouseleave', () => {
                resetCursor();
            });
        });

        // Otros Listeners
        document.querySelectorAll('a, button, .hover-trigger, .play-btn').forEach(el => {
            el.addEventListener('mouseenter', (e) => {
                if(!e.target.closest('.tilt-card')) { // Evitar conflicto
                    resetCursor();
                    cursor.classList.add('hovered');
                }
            });
            el.addEventListener('mouseleave', () => resetCursor());
        });


        // Video
        document.querySelector('.video-cursor-area')?.addEventListener('mouseenter', () => { resetCursor(); cursor.classList.add('video-mode'); cursorText.innerText="VER"; });
        document.querySelector('.video-cursor-area')?.addEventListener('mouseleave', () => resetCursor());

        // Lapu
        document.getElementById('lapu-section')?.addEventListener('mouseenter', () => { resetCursor(); cursor.classList.add('dream-mode'); });
        document.getElementById('lapu-section')?.addEventListener('mouseleave', () => resetCursor());


        // C. SCROLL HORIZONTAL
        const panels = gsap.utils.toArray(".panel");
        const container = document.getElementById("horizontal-wrapper");
        if(panels.length > 0 && container) {
            gsap.to(panels, {
                xPercent: -100 * (panels.length - 1),
                ease: "none",
                scrollTrigger: {
                    trigger: "#identity-section", pin: true, scrub: 1,
                    snap: 1 / (panels.length - 1), end: () => "+=" + container.offsetWidth
                }
            });
            // Cursor Drag para Identidad
            const idSection = document.getElementById('identity-section');
            if(idSection) {
                idSection.addEventListener('mouseenter', () => { resetCursor(); cursor.classList.add('hovered'); cursorText.innerText = "DESLIZA"; });
                idSection.addEventListener('mouseleave', () => resetCursor());
            }
        }

        // D. TILT
        if (typeof VanillaTilt !== 'undefined') {
             VanillaTilt.init(document.querySelectorAll(".tilt-card"), { max: 10, speed: 400, glare: true, "max-glare": 0.2 });
        }

        // E. THREE.JS GLOBAL
        const initGlobalThree = () => {
            const canvas = document.getElementById('global-canvas');
            if(!canvas) return;
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

            const count = 2500;
            const geometry = new THREE.BufferGeometry();
            const pos = new Float32Array(count*3);
            const colors = new Float32Array(count*3);
            const cSand = new THREE.Color('#C89F65');
            const cStar = new THREE.Color('#A5D8FF');

            for(let i=0; i<count*3; i+=3) {
                pos[i] = (Math.random()-0.5)*35; pos[i+1] = (Math.random()-0.5)*40; pos[i+2] = (Math.random()-0.5)*20;
                colors[i]=cSand.r; colors[i+1]=cSand.g; colors[i+2]=cSand.b;
            }
            geometry.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

            const material = new THREE.PointsMaterial({ size: 0.04, vertexColors: true, transparent: true, opacity: 0.8, blending: THREE.AdditiveBlending });
            const particles = new THREE.Points(geometry, material);
            scene.add(particles);
            camera.position.z = 5;

            const simplex = new SimplexNoise();
            const clock = new THREE.Clock();
            let speedMultiplier = 1;

            const animate = () => {
                const t = clock.getElapsedTime();
                particles.rotation.y = t * 0.02 * speedMultiplier;
                const p = geometry.attributes.position.array;
                for(let i=0; i<count; i++) {
                    const i3 = i*3;
                    if(speedMultiplier > 2) {
                        p[i3+2] += 0.1 * speedMultiplier;
                        if(p[i3+2] > 10) p[i3+2] = -20;
                    } else {
                        p[i3+1] = (Math.random()-0.5)*40 + simplex.noise2D(p[i3]*0.1, t*0.2)*0.3;
                    }
                }
                geometry.attributes.position.needsUpdate = true;
                renderer.render(scene, camera);
                requestAnimationFrame(animate);
            };
            animate();

            // Jepira
            if(typeof gsap !== 'undefined' && document.getElementById('cosmos-overlay')) {
                ScrollTrigger.create({
                    trigger: "#jepira-section", start: "top center",
                    onEnter: () => {
                        gsap.to("#cosmos-overlay", {opacity: 1, duration: 2});
                        gsap.to({v:1}, {v:10, duration: 3, onUpdate: function(){ speedMultiplier = this.targets()[0].v }});
                        const c = geometry.attributes.color.array;
                        const obj = {t:0};
                        gsap.to(obj, {t:1, duration:2, onUpdate:()=>{
                            for(let i=0; i<count*3; i+=3) {
                                c[i] = THREE.MathUtils.lerp(cSand.r, cStar.r, obj.t);
                                c[i+1] = THREE.MathUtils.lerp(cSand.g, cStar.g, obj.t);
                                c[i+2] = THREE.MathUtils.lerp(cSand.b, cStar.b, obj.t);
                            }
                            geometry.attributes.color.needsUpdate = true;
                        }});
                    },
                    onLeaveBack: () => {
                         gsap.to("#cosmos-overlay", {opacity: 0, duration: 2});
                         gsap.to({v:10}, {v:1, duration: 2, onUpdate: function(){ speedMultiplier = this.targets()[0].v }});
                         const c = geometry.attributes.color.array;
                         const obj = {t:0};
                         gsap.to(obj, {t:1, duration:2, onUpdate:()=>{
                            for(let i=0; i<count*3; i+=3) {
                                c[i] = THREE.MathUtils.lerp(cStar.r, cSand.r, obj.t);
                                c[i+1] = THREE.MathUtils.lerp(cStar.g, cSand.g, obj.t);
                                c[i+2] = THREE.MathUtils.lerp(cStar.b, cSand.b, obj.t);
                            }
                            geometry.attributes.color.needsUpdate = true;
                         }});
                    }
                });
            }
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        };
        initGlobalThree();

        // F. THREE.JS WEAVING
        (function() {
            const container = document.getElementById('weaving-container');
            if(!container) return;
            const scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050200, 0.002);
            const camera = new THREE.PerspectiveCamera(75, container.clientWidth/container.clientHeight, 0.1, 1000);
            camera.position.z = 15;
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);
            const group = new THREE.Group();
            scene.add(group);
            const pCount = 300;
            const pData = [];
            const pGeo = new THREE.BufferGeometry();
            const pPos = new Float32Array(pCount*3);
            for(let i=0; i<pCount; i++) {
                const theta = Math.random()*Math.PI*2;
                const phi = Math.acos((Math.random()*2)-1);
                const r = 6;
                pPos[i*3] = r*Math.sin(phi)*Math.cos(theta);
                pPos[i*3+1] = r*Math.sin(phi)*Math.sin(theta);
                pPos[i*3+2] = r*Math.cos(phi);
                pData.push({ vel: new THREE.Vector3(Math.random()-0.5, Math.random()-0.5, Math.random()-0.5).multiplyScalar(0.02), con:0 });
            }
            pGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3).setUsage(THREE.DynamicDrawUsage));
            const points = new THREE.Points(pGeo, new THREE.PointsMaterial({color: 0xFF3B3B, size: 0.1, transparent:true}));
            group.add(points);
            const lGeo = new THREE.BufferGeometry();
            const lPos = new Float32Array(pCount*pCount*3);
            const lCol = new Float32Array(pCount*pCount*3);
            lGeo.setAttribute('position', new THREE.BufferAttribute(lPos, 3).setUsage(THREE.DynamicDrawUsage));
            lGeo.setAttribute('color', new THREE.BufferAttribute(lCol, 3).setUsage(THREE.DynamicDrawUsage));
            const lines = new THREE.LineSegments(lGeo, new THREE.LineBasicMaterial({vertexColors: true, transparent:true, opacity:0.4}));
            group.add(lines);
            let mx=0, my=0;
            container.addEventListener('mousemove', e => {
                mx = ((e.clientX - container.getBoundingClientRect().left)/container.clientWidth)*2-1;
                my = -((e.clientY - container.getBoundingClientRect().top)/container.clientHeight)*2+1;
            });
            const animate = () => {
                group.rotation.x += 0.002 + my*0.01;
                group.rotation.y += 0.002 + mx*0.01;
                let vPos=0, cPos=0, con=0;
                for(let i=0; i<pCount; i++) pData[i].con=0;
                for(let i=0; i<pCount; i++) {
                    pPos[i*3] += pData[i].vel.x; pPos[i*3+1] += pData[i].vel.y; pPos[i*3+2] += pData[i].vel.z;
                    const d = Math.sqrt(pPos[i*3]**2 + pPos[i*3+1]**2 + pPos[i*3+2]**2);
                    if(d>7 || d<4) pData[i].vel.multiplyScalar(-1);
                    if(pData[i].con>=3) continue;
                    for(let j=i+1; j<pCount; j++) {
                        if(pData[j].con>=3) continue;
                        const dx = pPos[i*3]-pPos[j*3], dy = pPos[i*3+1]-pPos[j*3+1], dz = pPos[i*3+2]-pPos[j*3+2];
                        const dist = Math.sqrt(dx*dx+dy*dy+dz*dz);
                        if(dist<2.5) {
                            pData[i].con++; pData[j].con++;
                            lPos[vPos++]=pPos[i*3]; lPos[vPos++]=pPos[i*3+1]; lPos[vPos++]=pPos[i*3+2];
                            lPos[vPos++]=pPos[j*3]; lPos[vPos++]=pPos[j*3+1]; lPos[vPos++]=pPos[j*3+2];
                            lCol[cPos++]=1; lCol[cPos++]=0.2+(dist*0.2); lCol[cPos++]=0.2;
                            lCol[cPos++]=1; lCol[cPos++]=0.2+(dist*0.2); lCol[cPos++]=0.2;
                            con++;
                        }
                    }
                }
                lines.geometry.setDrawRange(0, con*2);
                lines.geometry.attributes.position.needsUpdate = true;
                lines.geometry.attributes.color.needsUpdate = true;
                points.geometry.attributes.position.needsUpdate = true;
                renderer.render(scene, camera);
                requestAnimationFrame(animate);
            };
            animate();
        })();

        // G. THREE.JS SHADER (SUEÑOS)
        (function() {
            const container = document.getElementById('dream-canvas-container');
            if(!container) return;
            const scene = new THREE.Scene();
            const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);
            function createTextTexture() {
                const cvs = document.createElement('canvas');
                cvs.width = window.innerWidth; cvs.height = window.innerHeight;
                const ctx = cvs.getContext('2d');
                const cx = cvs.width/2, cy = cvs.height/2;
                ctx.font = "italic 700 18vw 'Playfair Display'"; ctx.fillStyle = "white"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
                ctx.fillText("LAPÜ", cx, cy);
                ctx.font = "300 1.5vw 'Manrope'"; ctx.fillStyle = "#C89F65";
                ctx.fillText("Los ancestros hablan cuando cierras los ojos", cx, cy + (cvs.width * 0.15));
                return new THREE.CanvasTexture(cvs);
            }
            const material = new THREE.ShaderMaterial({
                uniforms: { uTime: {value:0}, uMouse: {value: new THREE.Vector2(0.5,0.5)}, uResolution: {value: new THREE.Vector2(window.innerWidth, window.innerHeight)}, uTexture: {value: createTextTexture()} },
                vertexShader: `varying vec2 vUv; void main(){vUv=uv; gl_Position=vec4(position,1.0);}`,
                fragmentShader: `
                    uniform float uTime; uniform vec2 uMouse; uniform vec2 uResolution; uniform sampler2D uTexture; varying vec2 vUv;
                    vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;} vec2 mod289(vec2 x){return x-floor(x*(1.0/289.0))*289.0;} vec3 permute(vec3 x){return mod289(((x*34.0)+1.0)*x);}
                    float snoise(vec2 v){ const vec4 C=vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439); vec2 i=floor(v+dot(v,C.yy)); vec2 x0=v-i+dot(i,C.xx); vec2 i1=(x0.x>x0.y)?vec2(1.0,0.0):vec2(0.0,1.0); vec4 x12=x0.xyxy+C.xxzz; x12.xy-=i1; i=mod289(i); vec3 p=permute(permute(i.y+vec3(0.0,i1.y,1.0))+i.x+vec3(0.0,i1.x,1.0)); vec3 m=max(0.5-vec3(dot(x0,x0),dot(x12.xy,x12.xy),dot(x12.zw,x12.zw)),0.0); m=m*m; m=m*m; vec3 x=2.0*fract(p*C.www)-1.0; vec3 h=abs(x)-0.5; vec3 ox=floor(x+0.5); vec3 a0=x-ox; m*=1.79284291400159-0.85373472095314*(a0*a0+h*h); vec3 g; g.x=a0.x*x0.x+h.x*x0.y; g.yz=a0.yz*x12.xz+h.yz*x12.yw; return 130.0*dot(m,g); }
                    void main(){
                        vec2 uv = vUv; vec2 ratio = vec2(uResolution.x/uResolution.y, 1.0);
                        float dist = distance(uv*ratio, uMouse*ratio);
                        float fog = snoise(uv*ratio*3.0 - uTime*0.1)*0.5 + snoise(uv*ratio*8.0 + uTime*0.05)*0.2;
                        float reveal = smoothstep(0.25, 0.1, dist + fog*0.2);
                        vec4 tex = texture2D(uTexture, uv + vec2(fog*0.1*(1.0-reveal)));
                        vec3 col = mix(vec3(0.0,0.0,0.05), tex.rgb, reveal*tex.a);
                        col += vec3(0.8,0.6,0.2) * (smoothstep(0.0,0.1,reveal)*(1.0-smoothstep(0.9,1.0,reveal))) * 0.2;
                        gl_FragColor = vec4(col, 1.0);
                    }
                `
            });
            scene.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2), material));
            const clock = new THREE.Clock();
            const mouse = new THREE.Vector2(0.5,0.5);
            window.addEventListener('mousemove', e=>{ mouse.x=e.clientX/window.innerWidth; mouse.y=1.0-e.clientY/window.innerHeight; });
            const animate = () => {
                material.uniforms.uTime.value = clock.getElapsedTime();
                material.uniforms.uMouse.value.lerp(mouse, 0.1);
                renderer.render(scene, camera);
                requestAnimationFrame(animate);
            };
            animate();
            window.addEventListener('resize', ()=>{
                renderer.setSize(window.innerWidth, window.innerHeight);
                material.uniforms.uResolution.value.set(window.innerWidth, window.innerHeight);
                material.uniforms.uTexture.value = createTextTexture();
            });
        })();

        // I. SMOOTH SCROLL (LENIS)
        if (typeof Lenis !== 'undefined') {
            const lenis = new Lenis({ duration: 1.5, smoothWheel: true });
            function raf(time) { lenis.raf(time); requestAnimationFrame(raf); }
            requestAnimationFrame(raf);
        }
    });
</script>
    
</body>
</html>
